<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lise de Migra√ß√£o de Cr√©dito - √çon</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background-color: #091B1E;
            color: #ffffff;
            line-height: 1.6;
            margin: 0;
            padding: 0;
        }
        
        .header {
            background: linear-gradient(135deg, #091B1E 0%, #133134 100%);
            color: white;
            padding: 3rem 2rem;
            text-align: center;
            border-bottom: 2px solid #A6CF2E;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: #ffffff;
            font-weight: 300;
            letter-spacing: 1px;
        }
        
        .header p {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 300;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .section {
            background: #133134;
            border-radius: 12px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            border: 1px solid rgba(166, 207, 46, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #A6CF2E 0%, rgba(166, 207, 46, 0.3) 100%);
        }
        
        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 2rem;
            border-bottom: 1px solid rgba(166, 207, 46, 0.2);
            padding-bottom: 1rem;
        }
        
        .section-number {
            background: #A6CF2E;
            color: #091B1E;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-right: 1rem;
            font-size: 18px;
            box-shadow: 0 2px 10px rgba(166, 207, 46, 0.3);
        }
        
        h2 {
            color: #ffffff;
            font-size: 1.8rem;
            font-weight: 400;
            letter-spacing: 0.5px;
        }
        
        h3 {
            color: #A6CF2E;
            margin-bottom: 1rem;
            font-weight: 400;
            font-size: 1.3rem;
            letter-spacing: 0.3px;
        }
        
        p {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.8;
        }
        
        .concept-box {
            background: rgba(19, 49, 52, 0.5);
            border-left: 4px solid #A6CF2E;
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
            backdrop-filter: blur(10px);
        }
        
        .concept-box h3 {
            color: #A6CF2E;
            font-size: 1.1rem;
        }
        
        .interactive-element {
            background: rgba(19, 49, 52, 0.6);
            border: 1px solid rgba(166, 207, 46, 0.2);
            border-radius: 10px;
            padding: 2rem;
            margin: 2rem 0;
            backdrop-filter: blur(5px);
        }
        
        .matrix-container {
            overflow-x: auto;
            margin: 2rem 0;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .transition-matrix {
            border-collapse: collapse;
            width: 100%;
            min-width: 600px;
            margin: 0 auto;
            font-size: 0.9rem;
            background: #133134;
        }
        
        .transition-matrix th,
        .transition-matrix td {
            border: 1px solid rgba(166, 207, 46, 0.2);
            padding: 12px;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .transition-matrix th {
            background: rgba(166, 207, 46, 0.15);
            color: #A6CF2E;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 1px;
        }
        
        .transition-matrix tbody th {
            background: rgba(166, 207, 46, 0.1);
            color: #A6CF2E;
        }
        
        .transition-matrix td {
            cursor: pointer;
            color: #ffffff;
            font-weight: 500;
        }
        
        .transition-matrix td:hover {
            background: rgba(166, 207, 46, 0.2);
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(166, 207, 46, 0.3);
        }
        
        .diagonal {
            background: rgba(166, 207, 46, 0.25) !important;
            font-weight: 700;
            color: #A6CF2E !important;
        }
        
        .upgrade {
            background: rgba(166, 207, 46, 0.1) !important;
            color: #A6CF2E !important;
        }
        
        .downgrade {
            background: rgba(236, 112, 0, 0.1) !important;
            color: #EC7000 !important;
        }
        
        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.1);
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #A6CF2E;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(166, 207, 46, 0.4);
            transition: all 0.2s ease;
        }
        
        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 2px 15px rgba(166, 207, 46, 0.6);
        }
        
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #A6CF2E;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 10px rgba(166, 207, 46, 0.4);
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin: 2rem 0;
            background: rgba(19, 49, 52, 0.4);
            border-radius: 10px;
            padding: 1.5rem;
            border: 1px solid rgba(166, 207, 46, 0.2);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .button {
            background: #A6CF2E;
            color: #091B1E;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 4px 15px rgba(166, 207, 46, 0.3);
        }
        
        .button:hover {
            background: #91b929;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(166, 207, 46, 0.4);
        }
        
        .button-secondary {
            background: transparent;
            color: #A6CF2E;
            border: 2px solid #A6CF2E;
            box-shadow: none;
        }
        
        .button-secondary:hover {
            background: rgba(166, 207, 46, 0.1);
            color: #A6CF2E;
            border-color: #91b929;
        }
        
        select.button {
            appearance: none;
            text-align: left;
            padding-right: 40px;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23091B1E' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
        }
        
        .result-box {
            background: linear-gradient(135deg, rgba(166, 207, 46, 0.1) 0%, rgba(19, 49, 52, 0.5) 100%);
            border: 2px solid #A6CF2E;
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            text-align: center;
            box-shadow: 0 4px 20px rgba(166, 207, 46, 0.2);
        }
        
        .result-box h3 {
            color: #A6CF2E;
            margin-bottom: 1rem;
            font-size: 1.4rem;
        }
        
        .commercial-tip {
            background: linear-gradient(135deg, rgba(166, 207, 46, 0.15) 0%, rgba(19, 49, 52, 0.8) 100%);
            border-radius: 12px;
            padding: 2rem;
            margin: 2rem 0;
            position: relative;
            padding-left: 3.5rem;
            border: 1px solid rgba(166, 207, 46, 0.3);
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        
        .commercial-tip::before {
            content: 'üí°';
            position: absolute;
            left: 1.5rem;
            top: 2rem;
            font-size: 1.5rem;
            filter: sepia(1) saturate(2) hue-rotate(45deg);
        }
        
        .commercial-tip h4 {
            color: #A6CF2E;
            margin-bottom: 0.75rem;
            font-weight: 500;
            font-size: 1.2rem;
        }
        
        .commercial-tip p {
            color: rgba(255, 255, 255, 0.95);
            line-height: 1.8;
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid rgba(166, 207, 46, 0.2);
            margin-bottom: 2rem;
        }
        
        .tab {
            padding: 1rem 2rem;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.6);
            transition: all 0.3s ease;
            position: relative;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 500;
        }
        
        .tab:hover {
            color: #A6CF2E;
        }
        
        .tab.active {
            color: #A6CF2E;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 3px;
            background: #A6CF2E;
            box-shadow: 0 0 10px rgba(166, 207, 46, 0.5);
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        .card {
            background: rgba(19, 49, 52, 0.6);
            border: 1px solid rgba(166, 207, 46, 0.2);
            border-radius: 10px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            border-color: rgba(166, 207, 46, 0.4);
        }
        
        .card h4 {
            color: #A6CF2E;
            margin-bottom: 1rem;
            font-weight: 500;
            font-size: 1.1rem;
        }
        
        .card span {
            color: #EC7000;
            font-size: 1.3rem;
            font-weight: 700;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #A6CF2E 0%, #91b929 100%);
            transition: width 0.6s ease;
            border-radius: 4px;
            box-shadow: 0 0 10px rgba(166, 207, 46, 0.5);
        }
        
        label {
            color: rgba(255, 255, 255, 0.9);
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        ul {
            color: rgba(255, 255, 255, 0.9);
        }
        
        strong {
            color: #A6CF2E;
            font-weight: 600;
        }
        
        #matrixDetail {
            background: linear-gradient(135deg, rgba(166, 207, 46, 0.2) 0%, rgba(19, 49, 52, 0.8) 100%);
            border-color: #A6CF2E;
        }
        
        #matrixDetail p {
            color: #ffffff;
            font-size: 1.1rem;
            line-height: 1.8;
        }
        
        .card ul {
            list-style: none;
            padding: 0;
        }
        
        .card ul li {
            color: rgba(255, 255, 255, 0.9);
            margin: 0.75rem 0;
            padding-left: 1.5rem;
            position: relative;
            font-size: 0.95rem;
        }
        
        .card ul li::before {
            content: '‚ñ∏';
            position: absolute;
            left: 0;
            color: #A6CF2E;
            font-size: 1.2rem;
        }
        
        /* Estilos para an√°lise setorial */
        .sector-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 2rem 0;
        }
        
        .sector-analysis {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2rem;
            margin: 2rem 0;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            color: #A6CF2E;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 10px rgba(166, 207, 46, 0.3);
        }
        
        .metric-label {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .stress-indicator {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
        }
        
        .stress-low {
            background: rgba(166, 207, 46, 0.2);
            color: #A6CF2E;
            border: 1px solid #A6CF2E;
        }
        
        .stress-medium {
            background: rgba(236, 112, 0, 0.2);
            color: #EC7000;
            border: 1px solid #EC7000;
        }
        
        .stress-high {
            background: rgba(255, 100, 100, 0.2);
            color: #ff6464;
            border: 1px solid #ff6464;
        }
        
        .stress-indicator:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .alert {
            background: rgba(236, 112, 0, 0.1);
            border: 2px solid rgba(236, 112, 0, 0.3);
            border-radius: 10px;
            padding: 1.25rem;
            margin: 1.5rem 0;
            border-left: 5px solid #EC7000;
        }
        
        .alert h4 {
            color: #EC7000;
            margin-bottom: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .alert-info {
            background: rgba(166, 207, 46, 0.1);
            border-color: rgba(166, 207, 46, 0.3);
            border-left-color: #A6CF2E;
        }
        
        .alert-info h4 {
            color: #A6CF2E;
        }
        
        /* Stress Test espec√≠fico */
        .stress-scenario {
            background: rgba(19, 49, 52, 0.8);
            border-radius: 12px;
            padding: 2rem;
            margin: 1rem 0;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .stress-scenario:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        
        .stress-scenario.conservador {
            border-color: rgba(166, 207, 46, 0.5);
        }
        
        .stress-scenario.moderado {
            border-color: rgba(236, 112, 0, 0.5);
        }
        
        .stress-scenario.panico {
            border-color: rgba(255, 100, 100, 0.5);
        }
        
        .scenario-header {
            display: flex;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .scenario-icon {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            font-size: 1.1rem;
            font-weight: 700;
            color: #091B1E;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }
        
        .scenario-icon.conservador {
            background: #A6CF2E;
        }
        
        .scenario-icon.moderado {
            background: #EC7000;
        }
        
        .scenario-icon.panico {
            background: #ff6464;
        }
        
        .impact-display {
            font-size: 2.2rem;
            font-weight: 700;
            text-align: center;
            margin: 1.5rem 0;
            padding: 1rem;
            border-radius: 8px;
        }
        
        .impact-conservador {
            background: rgba(166, 207, 46, 0.1);
            color: #A6CF2E;
            border: 2px solid rgba(166, 207, 46, 0.3);
        }
        
        .impact-moderado {
            background: rgba(236, 112, 0, 0.1);
            color: #EC7000;
            border: 2px solid rgba(236, 112, 0, 0.3);
        }
        
        .impact-panico {
            background: rgba(255, 100, 100, 0.1);
            color: #ff6464;
            border: 2px solid rgba(255, 100, 100, 0.3);
        }
        
        .comparison-section {
            background: rgba(19, 49, 52, 0.8);
            border: 2px solid rgba(166, 207, 46, 0.3);
            border-radius: 12px;
            padding: 2.5rem;
            margin: 2rem 0;
        }
        
        @media (max-width: 768px) {
            .sector-grid, .sector-analysis {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .container {
                padding: 1rem;
            }
            
            .grid {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                padding: 0.75rem 1rem;
            }
        }
        
        /* Loading spinner */
        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(166, 207, 46, 0.3);
            border-radius: 50%;
            border-top-color: #A6CF2E;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }
        
        ::-webkit-scrollbar-track {
            background: #091B1E;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #A6CF2E;
            border-radius: 5px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #91b929;
        }
        
        /* Input fields */
        input[type="text"], input[type="number"] {
            background: rgba(19, 49, 52, 0.8);
            border: 1px solid rgba(166, 207, 46, 0.3);
            color: #ffffff;
            padding: 0.75rem;
            border-radius: 6px;
            width: 100%;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }
        
        input[type="text"]:focus, input[type="number"]:focus {
            outline: none;
            border-color: #A6CF2E;
            box-shadow: 0 0 10px rgba(166, 207, 46, 0.3);
        }
        
        /* Hover effects for interactive elements */
        .interactive-element:hover {
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            border-color: rgba(166, 207, 46, 0.4);
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>An√°lise de Migra√ß√£o de Cr√©dito</h1>
        <p>Matrizes de Transi√ß√£o, Impactos na Marca√ß√£o e Estrat√©gias de Riding the Curve</p>
        <div style="margin-top: 1rem; font-size: 0.85rem; opacity: 0.7;">
            <span>Modelo te√≥rico educacional</span>
        </div>
    </div>




<!-- Assinatura com efeito de marca d'√°gua no canto superior DIREITO-->
<div class="watermark">
    <p><strong>Autor:</strong> Igor Stramandinoli Moita Pontes</p>
    <p><strong>E-mail:</strong> igor.pontes@itau-unibanco.com.br</p>
</div>

<style>
.watermark {
    position: fixed;
    top: 20px; /* trocado de bottom para top */
    right: 20px; /* trocado de right para left */
    background-color: rgba(19, 49, 52, 0.3); /* fundo com transpar√™ncia */
    border: 1px solid rgba(166, 207, 46, 0.4); /* borda verde transl√∫cida */
    border-radius: 10px;
    padding: 14px 18px;
    color: rgba(255, 255, 255, 0.6); /* texto branco transl√∫cido */
    font-family: 'Segoe UI', sans-serif;
    font-size: 13px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    z-index: 9999;
    pointer-events: none;
    user-select: none;
    max-width: 300px;
    opacity: 0.7; /* transpar√™ncia geral do bloco */
}

.watermark p {
    margin: 4px 0;
}

.watermark strong {
    color: rgba(166, 207, 46, 0.7); /* destaque verde transl√∫cido */
}
</style>




    <div class="container">
        <!-- Navega√ß√£o -->
        <div class="section">
            <h3 style="text-align: center; margin-bottom: 2rem;">Navega√ß√£o R√°pida</h3>
            <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                <button class="button button-secondary" onclick="smoothScrollTo('section-transition')">
                    Matrizes
                </button>
                <button class="button button-secondary" onclick="smoothScrollTo('section-impact')">
                    Impacto
                </button>
                <button class="button button-secondary" onclick="smoothScrollTo('section-riding')">
                    Riding
                </button>
                <button class="button button-secondary" onclick="smoothScrollTo('section-stress')">
                    Stress Test
                </button>
                <button class="button button-secondary" onclick="smoothScrollTo('section-summary')">
                    Aplica√ß√£o
                </button>
            </div>
            <div style="text-align: center; margin-top: 2rem;">
                <button class="button" onclick="togglePremissas();">
                    Ver Premissas do Modelo
                </button>
                <button class="button button-secondary" onclick="resetAllSimulations();">
                    Reset Geral
                </button>
            </div>
        </div>
        
        <!-- Se√ß√£o de Premissas do Modelo -->
        <div id="premissasModelo" style="display: none;" class="section">
            <div class="section-header">
                <div class="section-number">P</div>
                <h2>Premissas do Modelo</h2>
            </div>
            
            <div class="alert">
                <h4>‚ö†Ô∏è MODELO TE√ìRICO EDUCACIONAL</h4>
                <p>Todos os dados s√£o ilustrativos - N√ÉO representam ativos reais</p>
            </div>
            
            <div class="sector-grid">
                <div class="card">
                    <h4>Curva de Juros Base</h4>
                    <table class="transition-matrix" style="font-size: 0.85rem;">
                        <thead>
                            <tr>
                                <th>Prazo</th>
                                <th>Taxa Base*</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>6 meses</td><td>3.50%</td></tr>
                            <tr><td>1 ano</td><td>4.00%</td></tr>
                            <tr><td>2 anos</td><td>4.80%</td></tr>
                            <tr><td>3 anos</td><td>5.20%</td></tr>
                            <tr><td>5 anos</td><td>6.00%</td></tr>
                            <tr><td>7 anos</td><td>6.50%</td></tr>
                            <tr><td>10 anos</td><td>7.00%</td></tr>
                        </tbody>
                    </table>
                    <p style="font-size: 0.75rem; margin-top: 0.5rem; opacity: 0.7;">
                        * CDI base ilustrativo + termo. N√ÉO √© a curva DI real.
                    </p>
                </div>
                
                <div class="card">
                    <h4>Spreads por Rating</h4>
                    <table class="transition-matrix" style="font-size: 0.85rem;">
                        <thead>
                            <tr>
                                <th>Rating</th>
                                <th>Spread*</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td>AAA</td><td>50 bps</td></tr>
                            <tr><td>AA</td><td>80 bps</td></tr>
                            <tr><td>A</td><td>120 bps</td></tr>
                            <tr><td>BBB</td><td>200 bps</td></tr>
                            <tr><td>BB</td><td>350 bps</td></tr>
                            <tr><td>B</td><td>600 bps</td></tr>
                        </tbody>
                    </table>
                    <p style="font-size: 0.75rem; margin-top: 0.5rem; opacity: 0.7;">
                        * Valores ilustrativos gen√©ricos
                    </p>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 2rem;">
                <button class="button button-secondary" onclick="togglePremissas()">Fechar Premissas</button>
            </div>
        </div>
        
        <!-- Se√ß√£o 1: Matrizes de Transi√ß√£o -->
        <div class="section" id="section-transition">
            <div class="alert">
                <h4>‚ö†Ô∏è Modelo Te√≥rico</h4>
                <p>Valores ilustrativos para fins educacionais</p>
            </div>
            
            <div class="section-header">
                <div class="section-number">1</div>
                <h2>Matrizes de Transi√ß√£o de Rating</h2>
            </div>
            
            <div class="concept-box">
                <h3>O que s√£o Matrizes de Transi√ß√£o?</h3>
                <p>As matrizes de transi√ß√£o mostram a probabilidade de um ativo migrar de um rating para outro em determinado per√≠odo. S√£o ferramentas essenciais para entender o risco de cr√©dito din√¢mico de uma carteira.</p>
                <div style="margin-top: 1rem; padding: 1rem; background: rgba(255, 255, 255, 0.05); border-radius: 6px;">
                    <p style="font-size: 0.9rem;">
                        <strong>Contexto brasileiro:</strong> As probabilidades apresentadas s√£o baseadas em hist√≥rico de CRI, CRA e Deb√™ntures no mercado local. 
                        Note que o mercado brasileiro tem caracter√≠sticas pr√≥prias: menor profundidade, concentra√ß√£o setorial e sensibilidade a fatores macroecon√¥micos locais.
                    </p>
                </div>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('teoria', this)">Teoria</button>
                <button class="tab" onclick="switchTab('pratica', this)">An√°lise Setorial</button>
                <button class="tab" onclick="switchTab('comercial', this)">Argumento Comercial</button>
            </div>

            <div class="tab-content active" id="teoria">
                <h3>Matriz de Transi√ß√£o Anual - Mercado Brasileiro</h3>
                <p>Clique em cada c√©lula para entender a probabilidade de migra√ß√£o:</p>
                
                <div class="matrix-container">
                    <table class="transition-matrix" id="transitionMatrix">
                        <thead>
                            <tr>
                                <th>De \ Para</th>
                                <th>AAA</th>
                                <th>AA</th>
                                <th>A</th>
                                <th>BBB</th>
                                <th>BB</th>
                                <th>B</th>
                                <th>Default</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <th>AAA</th>
                                <td class="diagonal" onclick="showDetail('AAA', 'AAA', 92.5)">92.5%</td>
                                <td class="downgrade" onclick="showDetail('AAA', 'AA', 6.8)">6.8%</td>
                                <td class="downgrade" onclick="showDetail('AAA', 'A', 0.5)">0.5%</td>
                                <td class="downgrade" onclick="showDetail('AAA', 'BBB', 0.2)">0.2%</td>
                                <td class="downgrade" onclick="showDetail('AAA', 'BB', 0)">0.0%</td>
                                <td class="downgrade" onclick="showDetail('AAA', 'B', 0)">0.0%</td>
                                <td class="downgrade" onclick="showDetail('AAA', 'Default', 0)">0.0%</td>
                            </tr>
                            <tr>
                                <th>AA</th>
                                <td class="upgrade" onclick="showDetail('AA', 'AAA', 1.2)">1.2%</td>
                                <td class="diagonal" onclick="showDetail('AA', 'AA', 88.3)">88.3%</td>
                                <td class="downgrade" onclick="showDetail('AA', 'A', 8.9)">8.9%</td>
                                <td class="downgrade" onclick="showDetail('AA', 'BBB', 1.3)">1.3%</td>
                                <td class="downgrade" onclick="showDetail('AA', 'BB', 0.3)">0.3%</td>
                                <td class="downgrade" onclick="showDetail('AA', 'B', 0)">0.0%</td>
                                <td class="downgrade" onclick="showDetail('AA', 'Default', 0)">0.0%</td>
                            </tr>
                            <tr>
                                <th>A</th>
                                <td class="upgrade" onclick="showDetail('A', 'AAA', 0.1)">0.1%</td>
                                <td class="upgrade" onclick="showDetail('A', 'AA', 2.5)">2.5%</td>
                                <td class="diagonal" onclick="showDetail('A', 'A', 85.6)">85.6%</td>
                                <td class="downgrade" onclick="showDetail('A', 'BBB', 9.8)">9.8%</td>
                                <td class="downgrade" onclick="showDetail('A', 'BB', 1.7)">1.7%</td>
                                <td class="downgrade" onclick="showDetail('A', 'B', 0.3)">0.3%</td>
                                <td class="downgrade" onclick="showDetail('A', 'Default', 0)">0.0%</td>
                            </tr>
                            <tr>
                                <th>BBB</th>
                                <td class="upgrade" onclick="showDetail('BBB', 'AAA', 0)">0.0%</td>
                                <td class="upgrade" onclick="showDetail('BBB', 'AA', 0.3)">0.3%</td>
                                <td class="upgrade" onclick="showDetail('BBB', 'A', 4.2)">4.2%</td>
                                <td class="diagonal" onclick="showDetail('BBB', 'BBB', 82.1)">82.1%</td>
                                <td class="downgrade" onclick="showDetail('BBB', 'BB', 10.5)">10.5%</td>
                                <td class="downgrade" onclick="showDetail('BBB', 'B', 2.4)">2.4%</td>
                                <td class="downgrade" onclick="showDetail('BBB', 'Default', 0.5)">0.5%</td>
                            </tr>
                            <tr>
                                <th>BB</th>
                                <td class="upgrade" onclick="showDetail('BB', 'AAA', 0)">0.0%</td>
                                <td class="upgrade" onclick="showDetail('BB', 'AA', 0)">0.0%</td>
                                <td class="upgrade" onclick="showDetail('BB', 'A', 0.5)">0.5%</td>
                                <td class="upgrade" onclick="showDetail('BB', 'BBB', 6.8)">6.8%</td>
                                <td class="diagonal" onclick="showDetail('BB', 'BB', 75.2)">75.2%</td>
                                <td class="downgrade" onclick="showDetail('BB', 'B', 14.3)">14.3%</td>
                                <td class="downgrade" onclick="showDetail('BB', 'Default', 3.2)">3.2%</td>
                            </tr>
                            <tr>
                                <th>B</th>
                                <td class="upgrade" onclick="showDetail('B', 'AAA', 0)">0.0%</td>
                                <td class="upgrade" onclick="showDetail('B', 'AA', 0)">0.0%</td>
                                <td class="upgrade" onclick="showDetail('B', 'A', 0.1)">0.1%</td>
                                <td class="upgrade" onclick="showDetail('B', 'BBB', 1.2)">1.2%</td>
                                <td class="upgrade" onclick="showDetail('B', 'BB', 8.5)">8.5%</td>
                                <td class="diagonal" onclick="showDetail('B', 'B', 68.9)">68.9%</td>
                                <td class="downgrade" onclick="showDetail('B', 'Default', 21.3)">15.3%</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div id="matrixDetail" class="result-box" style="display: none;">
                    <p id="detailText"></p>
                </div>
            </div>

            <div class="tab-content" id="pratica">
                <h3>An√°lise Setorial e Cen√°rios Macro</h3>
                
                <div class="sector-grid">
                    <div>
                        <label for="sectorSelect">Setor de An√°lise:</label>
                        <select id="sectorSelect" class="button" style="width: 100%; margin-top: 0.5rem;" onchange="updateSectorAnalysis()">
                            <option value="agro">Agroneg√≥cio</option>
                            <option value="infra">Infraestrutura</option>
                            <option value="energia">Energia</option>
                            <option value="financeiro">Financeiro</option>
                            <option value="industrial">Industrial</option>
                        </select>
                    </div>
                    <div>
                        <label for="scenarioSelect">Cen√°rio Econ√¥mico:</label>
                        <select id="scenarioSelect" class="button" style="width: 100%; margin-top: 0.5rem;" onchange="updateSectorAnalysis()">
                            <option value="base">Base</option>
                            <option value="stress">Stress Moderado</option>
                            <option value="crisis">Crise Severa</option>
                        </select>
                    </div>
                </div>
                
                <div class="sector-analysis">
                    <div>
                        <div class="chart-container">
                            <canvas id="sectorChart"></canvas>
                        </div>
                    </div>
                    <div>
                        <div class="card">
                            <h4>üìä M√©tricas do Setor</h4>
                            <div class="metric-value" id="sectorRisk">Baixo</div>
                            <div class="metric-label">N√≠vel de Risco</div>
                            
                            <div class="metric-value" id="migrationProb" style="margin-top: 1rem;">7.2%</div>
                            <div class="metric-label">Prob. Migra√ß√£o Negativa</div>
                            
                            <div class="metric-value" id="correlationIndex" style="margin-top: 1rem;">0.45</div>
                            <div class="metric-label">Correla√ß√£o Setorial</div>
                        </div>
                        
                        <div class="card" style="margin-top: 1rem;">
                            <h4>üéØ Principais Riscos</h4>
                            <div id="sectorRisks">
                                <span class="stress-indicator stress-medium">Clima</span>
                                <span class="stress-indicator stress-medium">Commodities</span>
                                <span class="stress-indicator stress-medium">Cambial</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="alert-info">
                    <h4>Estrat√©gia Recomendada</h4>
                    <p id="sectorStrategy">Para o setor de Agroneg√≥cio em cen√°rio base, recomenda-se manter exposi√ß√£o balanceada com foco em ratings A/BBB de grandes cooperativas e traders.</p>
                </div>
            </div>

            <div class="tab-content" id="comercial">
                <div class="commercial-tip">
                    <h4>Argumento Comercial</h4>
                    <p>"Sr. Cliente, ao diversificar entre ratings e setores, conseguimos balancear retorno e seguran√ßa. Nossa an√°lise setorial permite identificar oportunidades espec√≠ficas e antecipar movimentos de mercado, oferecendo vantagem competitiva na gest√£o da sua carteira."</p>
                </div>
                
                <h3>Pontos-Chave para Abordagem:</h3>
                <ul style="list-style: none; padding: 0;">
                    <li style="margin: 1rem 0; padding-left: 1.5rem;">‚úì <strong>An√°lise Setorial Diferenciada:</strong> Mostre como diferentes setores reagem a ciclos econ√¥micos</li>
                    <li style="margin: 1rem 0; padding-left: 1.5rem;">‚úì <strong>Gest√£o Ativa:</strong> Destaque a import√¢ncia do monitoramento cont√≠nuo por setor</li>
                    <li style="margin: 1rem 0; padding-left: 1.5rem;">‚úì <strong>Cen√°rios Macro:</strong> Demonstre prepara√ß√£o para diferentes ambientes econ√¥micos</li>
                    <li style="margin: 1rem 0; padding-left: 1.5rem;">‚úì <strong>Timing de Mercado:</strong> Identifique momentos √≥timos para entrada/sa√≠da por setor</li>
                </ul>
            </div>
        </div>

        <!-- Se√ß√£o 2: Impacto na Marca√ß√£o -->
        <div class="section" id="section-impact">
            <div class="alert">
                <h4>‚ö†Ô∏è Modelo Te√≥rico</h4>
                <p>Valores ilustrativos para fins educacionais apenas</p>
            </div>
            
            <div class="section-header">
                <div class="section-number">2</div>
                <h2>Impacto de Mudan√ßas de Rating na Marca√ß√£o</h2>
            </div>
            
            <div class="concept-box">
                <h3>Como o Rating Afeta o Pre√ßo?</h3>
                <p>Mudan√ßas de rating impactam diretamente o spread de cr√©dito e, consequentemente, o pre√ßo do ativo. Um downgrade aumenta o spread exigido pelo mercado, reduzindo o pre√ßo (e vice-versa).</p>
            </div>

            <h3>Simulador de Impacto no Pre√ßo</h3>
            <div class="interactive-element">
                <div class="sector-grid">
                    <div>
                        <label><strong>Rating Atual:</strong></label>
                        <select id="currentRating" class="button" style="width: 100%; margin-top: 0.5rem;" onchange="calculateImpact()">
                            <option value="AAA">AAA</option>
                            <option value="AA">AA</option>
                            <option value="A" selected>A</option>
                            <option value="BBB">BBB</option>
                            <option value="BB">BB</option>
                            <option value="B">B</option>
                        </select>
                    </div>
                    <div>
                        <label><strong>Novo Rating:</strong></label>
                        <select id="newRating" class="button" style="width: 100%; margin-top: 0.5rem;" onchange="calculateImpact()">
                            <option value="AAA">AAA</option>
                            <option value="AA">AA</option>
                            <option value="A">A</option>
                            <option value="BBB" selected>BBB</option>
                            <option value="BB">BB</option>
                            <option value="B">B</option>
                        </select>
                    </div>
                </div>
                
                <div style="margin-top: 2rem;">
                    <label><strong>Duration do Ativo (anos):</strong> <span id="durationValue" style="color: #A6CF2E;">3</span></label>
                    <input type="range" class="slider" id="duration" min="1" max="10" value="3" step="0.5" oninput="updateDuration()">
                </div>
                
                <div id="impactResult" class="result-box" style="margin-top: 2rem;">
                    <h3>Impacto Estimado no Pre√ßo</h3>
                    <p style="font-size: 2.5rem; color: #EC7000; margin: 1rem 0; font-weight: 700;" id="priceImpact">-2.4%</p>
                    <p id="spreadChange" style="font-size: 1.1rem;">Aumento de spread: +80 bps</p>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="spreadChart"></canvas>
            </div>

            <div class="commercial-tip">
                <h4>Argumento Comercial</h4>
                <p>"Veja como um downgrade de A para BBB em um ativo com duration de 3 anos pode impactar em -2.4% no pre√ßo. Por isso, nossa an√°lise propriet√°ria complementa os ratings das ag√™ncias, permitindo antecipar movimentos e proteger seu patrim√¥nio."</p>
            </div>
        </div>

        <!-- Se√ß√£o 3: Riding the Curve -->
        <div class="section" id="section-riding">
            <div class="alert">
                <h4>‚ö†Ô∏è Modelo Te√≥rico</h4>
                <p>Valores ilustrativos para fins educacionais apenas</p>
            </div>
            
            <div class="section-header">
                <div class="section-number">3</div>
                <h2>Estrat√©gias de Riding the Curve em Cr√©dito</h2>
            </div>
            
            <div class="concept-box">
                <h3>O que √© Riding the Curve?</h3>
                <p>Estrat√©gia que busca capturar o ganho natural quando um t√≠tulo se aproxima do vencimento e "desce" pela curva de juros, gerando retorno adicional al√©m do carry.</p>
                <div style="margin-top: 1rem; padding: 1rem; background: rgba(255, 255, 255, 0.05); border-radius: 6px;">
                    <p style="font-size: 0.9rem; color: rgba(255, 255, 255, 0.8);">
                        <strong style="color: #EC7000;">‚ö†Ô∏è Notas Importantes:</strong><br>
                        1. Este simulador utiliza uma curva de juros simplificada baseada em dados de mercado<br>
                        2. N√£o considera volatilidade real ou liquidez de CRI/CRA/Deb√™ntures<br>
                        3. N√£o inclui eventos de liquidez (amortiza√ß√µes, resgates antecipados, calls)
                    </p>
                </div>
            </div>

            <h3>Simulador de Riding the Curve</h3>
            <div class="interactive-element">
                <p>Configure os par√¢metros e veja o potencial de retorno:</p>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1.5rem; margin: 2rem 0;">
                    <div>
                        <label>Prazo Inicial (anos):</label>
                        <select id="initialTerm" class="button" style="width: 100%;" onchange="updateHoldingOptions(); updateRidingCurve()">
                            <option value="3">3 anos</option>
                            <option value="5" selected>5 anos</option>
                            <option value="7">7 anos</option>
                            <option value="10">10 anos</option>
                        </select>
                    </div>
                    <div>
                        <label>Per√≠odo de Holding:</label>
                        <select id="holdingPeriod" class="button" style="width: 100%;" onchange="updateRidingCurve()">
                            <option value="0.5">6 meses</option>
                            <option value="1" selected>1 ano</option>
                            <option value="1.5">1.5 anos</option>
                            <option value="2">2 anos</option>
                            <option value="3">3 anos</option>
                            <option value="4">4 anos</option>
                        </select>
                    </div>
                    <div>
                        <label>Rating do Emissor:</label>
                        <select id="issuerRating" class="button" style="width: 100%;" onchange="updateRidingCurve()">
                            <option value="AAA">AAA</option>
                            <option value="AA" selected>AA</option>
                            <option value="A">A</option>
                            <option value="BBB">BBB</option>
                        </select>
                    </div>
                </div>
                
                <div class="chart-container">
                    <canvas id="ridingCurveChart"></canvas>
                </div>
                
                <div class="result-box">
                    <h3>An√°lise da Estrat√©gia</h3>
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 2rem; margin-top: 1.5rem;">
                        <div>
                            <p style="margin: 0; opacity: 0.8;">Retorno do Carry</p>
                            <p style="font-size: 2rem; color: #ffffff; margin: 0.5rem 0; font-weight: 700;" id="carryReturn">+5.2%</p>
                        </div>
                        <div>
                            <p style="margin: 0; opacity: 0.8;">Ganho Roll-Down</p>
                            <p style="font-size: 2rem; color: #A6CF2E; margin: 0.5rem 0; font-weight: 700;" id="rolldownGain">+1.8%</p>
                        </div>
                        <div>
                            <p style="margin: 0; opacity: 0.8;">Retorno Total</p>
                            <p style="font-size: 2rem; color: #EC7000; margin: 0.5rem 0; font-weight: 700;" id="totalReturn">+7.0%</p>
                        </div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 2rem;">
                    <button class="button" onclick="showOptimalStrategy()">Ver Estrat√©gia √ìtima</button>
                    <button class="button button-secondary" onclick="compareRidingStrategies()">Comparar Estrat√©gias</button>
                </div>
            </div>

            <div id="optimalStrategy" style="display: none;" class="result-box">
                <h3>Estrat√©gia √ìtima Identificada</h3>
                <p>Para maximizar o retorno riding the curve com rating AA:</p>
                <ul style="list-style: none; padding: 0; text-align: left; margin-top: 1.5rem;">
                    <li>‚ñ∏ Comprar t√≠tulos com prazo de 5-7 anos</li>
                    <li>‚ñ∏ Manter por 1-2 anos</li>
                    <li>‚ñ∏ Vender quando o prazo residual for de 3-5 anos</li>
                    <li>‚ñ∏ Retorno adicional esperado: +2.5% a.a. al√©m do carry</li>
                </ul>
            </div>

            <div id="ridingComparison" style="display: none;" class="comparison-section">
                <h3>Comparador de Estrat√©gias Riding the Curve</h3>
                
                <div class="grid" style="grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin-bottom: 2rem;">
                    <div class="card">
                        <h4>Estrat√©gia 1</h4>
                        <label>Prazo:</label>
                        <select class="button" style="width: 100%; margin: 0.5rem 0;" id="strat1Term" onchange="updateStrategyHoldingOptions(1)">
                            <option value="3">3 anos</option>
                            <option value="5" selected>5 anos</option>
                            <option value="7">7 anos</option>
                            <option value="10">10 anos</option>
                        </select>
                        <label>Holding:</label>
                        <select class="button" style="width: 100%; margin: 0.5rem 0;" id="strat1Hold">
                            <option value="0.5">6 meses</option>
                            <option value="1" selected>1 ano</option>
                            <option value="1.5">1.5 anos</option>
                            <option value="2">2 anos</option>
                            <option value="3">3 anos</option>
                            <option value="4">4 anos</option>
                        </select>
                        <label>Rating:</label>
                        <select class="button" style="width: 100%; margin: 0.5rem 0;" id="strat1Rating">
                            <option value="AAA">AAA</option>
                            <option value="AA" selected>AA</option>
                            <option value="A">A</option>
                            <option value="BBB">BBB</option>
                        </select>
                    </div>
                    
                    <div class="card">
                        <h4>Estrat√©gia 2</h4>
                        <label>Prazo:</label>
                        <select class="button" style="width: 100%; margin: 0.5rem 0;" id="strat2Term" onchange="updateStrategyHoldingOptions(2)">
                            <option value="3">3 anos</option>
                            <option value="5">5 anos</option>
                            <option value="7" selected>7 anos</option>
                            <option value="10">10 anos</option>
                        </select>
                        <label>Holding:</label>
                        <select class="button" style="width: 100%; margin: 0.5rem 0;" id="strat2Hold">
                            <option value="0.5">6 meses</option>
                            <option value="1">1 ano</option>
                            <option value="1.5">1.5 anos</option>
                            <option value="2" selected>2 anos</option>
                            <option value="3">3 anos</option>
                            <option value="4">4 anos</option>
                        </select>
                        <label>Rating:</label>
                        <select class="button" style="width: 100%; margin: 0.5rem 0;" id="strat2Rating">
                            <option value="AAA">AAA</option>
                            <option value="AA" selected>AA</option>
                            <option value="A">A</option>
                            <option value="BBB">BBB</option>
                        </select>
                    </div>
                    
                    <div class="card">
                        <h4>Estrat√©gia 3</h4>
                        <label>Prazo:</label>
                        <select class="button" style="width: 100%; margin: 0.5rem 0;" id="strat3Term" onchange="updateStrategyHoldingOptions(3)">
                            <option value="3" selected>3 anos</option>
                            <option value="5">5 anos</option>
                            <option value="7">7 anos</option>
                            <option value="10">10 anos</option>
                        </select>
                        <label>Holding:</label>
                        <select class="button" style="width: 100%; margin: 0.5rem 0;" id="strat3Hold">
                            <option value="0.5" selected>6 meses</option>
                            <option value="1">1 ano</option>
                            <option value="1.5">1.5 anos</option>
                            <option value="2">2 anos</option>
                            <option value="3">3 anos</option>
                        </select>
                        <label>Rating:</label>
                        <select class="button" style="width: 100%; margin: 0.5rem 0;" id="strat3Rating">
                            <option value="AAA">AAA</option>
                            <option value="AA">AA</option>
                            <option value="A" selected>A</option>
                            <option value="BBB">BBB</option>
                        </select>
                    </div>
                </div>
                
                <div style="text-align: center; margin-bottom: 2rem;">
                    <button class="button" onclick="runRidingComparison()">Executar Compara√ß√£o</button>
                    <button class="button button-secondary" onclick="closeRidingComparison()">Fechar</button>
                </div>
                
                <div id="ridingComparisonResults" style="display: none;">
                    <div class="chart-container">
                        <canvas id="comparisonChart"></canvas>
                    </div>
                    
                    <div class="matrix-container" style="margin-top: 2rem;">
                        <table class="transition-matrix" id="comparisonTable">
                            <thead>
                                <tr>
                                    <th>Estrat√©gia</th>
                                    <th>Configura√ß√£o</th>
                                    <th>Taxa Inicial</th>
                                    <th>Carry</th>
                                    <th>Roll-Down</th>
                                    <th>Total</th>
                                    <th>Ranking</th>
                                </tr>
                            </thead>
                            <tbody id="comparisonTableBody">
                            </tbody>
                        </table>
                    </div>
                    
                    <div class="result-box" style="margin-top: 2rem;">
                        <h3>üèÜ An√°lise Comparativa</h3>
                        <p id="comparisonAnalysis"></p>
                    </div>
                </div>
            </div>

            <div class="commercial-tip">
                <h4>Argumento Comercial</h4>
                <p>"Sr. Cliente, a estrat√©gia de riding the curve permite potencializar retornos atrav√©s da gest√£o ativa de duration. Nossa expertise em cr√©dito privado identifica as melhores oportunidades de timing, balanceando carry e movimento de curva para maximizar seus ganhos."</p>
            </div>
        </div>

        <!-- Se√ß√£o 4: Stress Test ROBUSTO -->
        <div class="section" id="section-stress">
            <div class="alert">
                <h4>‚ö†Ô∏è Modelo Te√≥rico</h4>
                <p>Valores ilustrativos para fins educacionais apenas</p>
            </div>
            
            <div class="section-header">
                <div class="section-number">4</div>
                <h2>An√°lise de Stress Test por Cen√°rios</h2>
            </div>
            
            <div class="concept-box">
                <h3>O que √© Stress Test em Cr√©dito Privado?</h3>
                <p>Simula√ß√£o do impacto de diferentes cen√°rios econ√¥micos na carteira, considerando mudan√ßas em spreads, defaults e migra√ß√µes de rating. Essencial para entender riscos em situa√ß√µes adversas e preparar estrat√©gias de conting√™ncia.</p>
            </div>
            
            <h3>Configura√ß√£o da Carteira para Stress Test</h3>
            <div class="grid" style="grid-template-columns: repeat(4, 1fr); gap: 1.5rem; margin-bottom: 2rem;">
                <div class="card">
                    <h4>Composi√ß√£o por Rating</h4>
                    <div style="margin: 1rem 0;">
                        <label>AAA/AA: <span id="highGradePerc" style="color: #A6CF2E;">30%</span></label>
                        <input type="range" class="slider" id="highGradeSlider" min="0" max="100" value="30" oninput="updateStressPortfolio()">
                        
                        <label style="margin-top: 1rem; display: block;">A/BBB: <span id="investGradePerc" style="color: #A6CF2E;">50%</span></label>
                        <input type="range" class="slider" id="investGradeSlider" min="0" max="100" value="50" oninput="updateStressPortfolio()">
                        
                        <label style="margin-top: 1rem; display: block;">BB/B: <span id="specGradePerc" style="color: #A6CF2E;">20%</span></label>
                        <input type="range" class="slider" id="specGradeSlider" min="0" max="100" value="20" oninput="updateStressPortfolio()">
                    </div>
                </div>
                
                <div class="card">
                    <h4>Par√¢metros Gerais</h4>
                    <div style="margin: 1rem 0;">
                        <label>Duration M√©dia (anos):</label>
                        <select class="button" style="width: 100%; margin: 0.5rem 0;" id="avgDuration">
                            <option value="2">2 anos</option>
                            <option value="3" selected>3 anos</option>
                            <option value="5">5 anos</option>
                            <option value="7">7 anos</option>
                        </select>
                        
                        <label>Valor da Carteira (R$ Mi):</label>
                        <select class="button" style="width: 100%; margin: 0.5rem 0;" id="portfolioValue">
                            <option value="10">R$ 10 Mi</option>
                            <option value="50" selected>R$ 50 Mi</option>
                            <option value="100">R$ 100 Mi</option>
                            <option value="500">R$ 500 Mi</option>
                        </select>
                        
                        <label>Spread M√©dio Atual:</label>
                        <input type="text" id="currentSpread" value="180 bps" disabled style="width: 100%; padding: 0.75rem; margin: 0.5rem 0; background: rgba(19, 49, 52, 0.8); border: 1px solid rgba(166, 207, 46, 0.3); color: #A6CF2E; text-align: center; border-radius: 6px;">
                    </div>
                </div>
                
                <div class="card">
                    <h4>Concentra√ß√£o Setorial</h4>
                    <div style="margin: 1rem 0;">
                        <label>Agroneg√≥cio: <span id="agroPerc" style="color: #A6CF2E;">25%</span></label>
                        <input type="range" class="slider" id="agroSlider" min="0" max="100" value="25" oninput="updateSectorConcentration()">
                        
                        <label style="margin-top: 1rem; display: block;">Infraestrutura: <span id="infraPerc" style="color: #A6CF2E;">30%</span></label>
                        <input type="range" class="slider" id="infraSlider" min="0" max="100" value="30" oninput="updateSectorConcentration()">
                        
                        <label style="margin-top: 1rem; display: block;">Energia: <span id="energiaPerc" style="color: #A6CF2E;">20%</span></label>
                        <input type="range" class="slider" id="energiaSlider" min="0" max="100" value="20" oninput="updateSectorConcentration()">
                        
                        <label style="margin-top: 1rem; display: block;">Outros: <span id="outrosPerc" style="color: #A6CF2E;">25%</span></label>
                        <input type="range" class="slider" id="outrosSlider" min="0" max="100" value="25" oninput="updateSectorConcentration()">
                    </div>
                </div>
                
                <div class="card">
                    <h4>Premissas Base</h4>
                    <ul style="font-size: 0.85rem; margin: 1rem 0;">
                        <li>Taxa CDI base: 4% a.a.</li>
                        <li>Recovery rate: 40%</li>
                        <li>Horizonte: 1 ano</li>
                        <li>Marca√ß√£o: MTM</li>
                        <li>Correla√ß√£o inter-setorial</li>
                        <li>Migra√ß√£o din√¢mica</li>
                    </ul>
                </div>
            </div>
            
            <div style="text-align: center; margin: 2rem 0;">
                <button class="button" onclick="runAdvancedStressTest()">üî• Executar Stress Test</button>
                <button class="button button-secondary" onclick="resetStressTest()">üîÑ Resetar</button>
                <button class="button button-secondary" onclick="exportStressResults()">üìä Exportar</button>
            </div>
            
            <div id="stressTestResults" style="display: none;">
                <h3>Resultados do Stress Test</h3>
                
                <!-- Cen√°rios de Stress -->
                <div class="grid" style="grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin: 2rem 0;">
                    <div class="stress-scenario conservador">
                        <div class="scenario-header">
                            <div class="scenario-icon conservador">C</div>
                            <div>
                                <h4 style="margin: 0; font-size: 1.1rem;">Cen√°rio Conservador</h4>
                                <p style="font-size: 0.85rem; margin: 0; opacity: 0.8;">Desacelera√ß√£o econ√¥mica leve</p>
                            </div>
                        </div>
                        <div class="impact-display impact-conservador" id="conservadorImpact">-2.5%</div>
                        <ul style="font-size: 0.85rem; margin-top: 1rem;">
                            <li>Spread: <span id="conservadorSpread">+50bps</span></li>
                            <li>Downgrades: <span id="conservadorDowngrade">10%</span></li>
                            <li>Defaults: <span id="conservadorDefault">0.5%</span></li>
                            <li>VaR 95%: <span id="conservadorVaR">-1.8%</span></li>
                        </ul>
                        <div class="progress-bar" style="margin-top: 1rem;">
                            <div class="progress-fill" id="conservadorProgress" style="width: 25%;"></div>
                        </div>
                    </div>
                    
                    <div class="stress-scenario moderado">
                        <div class="scenario-header">
                            <div class="scenario-icon moderado">M</div>
                            <div>
                                <h4 style="margin: 0; font-size: 1.1rem;">Cen√°rio Moderado</h4>
                                <p style="font-size: 0.85rem; margin: 0; opacity: 0.8;">Recess√£o e stress de cr√©dito</p>
                            </div>
                        </div>
                        <div class="impact-display impact-moderado" id="moderadoImpact">-7.8%</div>
                        <ul style="font-size: 0.85rem; margin-top: 1rem;">
                            <li>Spread: <span id="moderadoSpread">+150bps</span></li>
                            <li>Downgrades: <span id="moderadoDowngrade">25%</span></li>
                            <li>Defaults: <span id="moderadoDefault">2.5%</span></li>
                            <li>VaR 95%: <span id="moderadoVaR">-6.2%</span></li>
                        </ul>
                        <div class="progress-bar" style="margin-top: 1rem;">
                            <div class="progress-fill" id="moderadoProgress" style="width: 65%; background: #EC7000;"></div>
                        </div>
                    </div>
                    
                    <div class="stress-scenario panico">
                        <div class="scenario-header">
                            <div class="scenario-icon panico">S</div>
                            <div>
                                <h4 style="margin: 0; font-size: 1.1rem;">Cen√°rio Severo</h4>
                                <p style="font-size: 0.85rem; margin: 0; opacity: 0.8;">Crise sist√™mica severa</p>
                            </div>
                        </div>
                        <div class="impact-display impact-panico" id="panicoImpact">-18.5%</div>
                        <ul style="font-size: 0.85rem; margin-top: 1rem;">
                            <li>Spread: <span id="panicoSpread">+400bps</span></li>
                            <li>Downgrades: <span id="panicoDowngrade">50%</span></li>
                            <li>Defaults: <span id="panicoDefault">8%</span></li>
                            <li>VaR 95%: <span id="panicoVaR">-15.2%</span></li>
                        </ul>
                        <div class="progress-bar" style="margin-top: 1rem;">
                            <div class="progress-fill" id="panicoProgress" style="width: 100%; background: #ff6464;"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Gr√°ficos Comparativos -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin: 2rem 0;">
                    <div class="chart-container">
                        <canvas id="stressChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="sectorStressChart"></canvas>
                    </div>
                </div>
                
                <!-- An√°lise Detalhada -->
                <div class="concept-box" style="margin-top: 2rem;">
                    <h4 style="margin-bottom: 1rem;">üìä An√°lise Detalhada dos Impactos</h4>
                    <div id="stressAnalysisDetail"></div>
                    
                    <div style="margin-top: 1.5rem; padding: 1.5rem; background: rgba(236, 112, 0, 0.1); border-radius: 10px; border: 1px solid rgba(236, 112, 0, 0.3);">
                        <h5 style="color: #EC7000; margin-bottom: 0.5rem;">üéØ Principais Conclus√µes:</h5>
                        <ul id="stressConclusions" style="font-size: 0.95rem; line-height: 1.8;">
                        </ul>
                    </div>
                </div>
                
                <!-- Simula√ß√£o Monte Carlo -->
                <div class="interactive-element" style="margin-top: 2rem;">
                    <h4 style="margin-bottom: 1rem;">Simula√ß√£o Monte Carlo</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <div>
                            <label>N√∫mero de Simula√ß√µes:</label>
                            <select class="button" style="width: 100%; margin: 0.5rem 0;" id="monteCarloSims">
                                <option value="1000">1,000</option>
                                <option value="5000" selected>5,000</option>
                                <option value="10000">10,000</option>
                            </select>
                        </div>
                        <div>
                            <label>Horizonte de An√°lise:</label>
                            <select class="button" style="width: 100%; margin: 0.5rem 0;" id="monteCarloHorizon">
                                <option value="3">3 meses</option>
                                <option value="6">6 meses</option>
                                <option value="12" selected>1 ano</option>
                                <option value="24">2 anos</option>
                            </select>
                        </div>
                    </div>
                    <div style="text-align: center; margin: 1.5rem 0;">
                        <button class="button" onclick="runMonteCarloSimulation()">Executar Monte Carlo</button>
                    </div>
                    <div id="monteCarloResults" style="display: none;">
                        <div class="chart-container">
                            <canvas id="monteCarloChart"></canvas>
                        </div>
                        <div class="grid" style="grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-top: 1.5rem;">
                            <div class="card">
                                <h4>VaR 95%</h4>
                                <div class="metric-value" id="monteCarloVaR95">-5.2%</div>
                                <div class="metric-label">Value at Risk</div>
                            </div>
                            <div class="card">
                                <h4>VaR 99%</h4>
                                <div class="metric-value" id="monteCarloVaR99">-8.7%</div>
                                <div class="metric-label">Tail Risk</div>
                            </div>
                            <div class="card">
                                <h4>Expected Shortfall</h4>
                                <div class="metric-value" id="monteCarloES">-9.8%</div>
                                <div class="metric-label">Conditional VaR</div>
                            </div>
                            <div class="card">
                                <h4>Probabilidade</h4>
                                <div class="metric-value" id="monteCarloProbLoss">15.3%</div>
                                <div class="metric-label">Perda > 5%</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Estrat√©gias de Mitiga√ß√£o -->
                <div class="commercial-tip" style="margin-top: 2rem;">
                    <h4>Estrat√©gias de Mitiga√ß√£o de Risco</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-top: 1.5rem;">
                        <div>
                            <h5 style="color: #A6CF2E; margin-bottom: 0.75rem;">Ajustes Preventivos:</h5>
                            <ul style="font-size: 0.9rem;">
                                <li><strong>Rebalanceamento:</strong> Reduzir exposi√ß√£o BB/B para m√°ximo 15%</li>
                                <li><strong>Duration:</strong> Diminuir para 2-2.5 anos em cen√°rios de stress</li>
                                <li><strong>Setorial:</strong> Aumentar infraestrutura regulada e reduzir c√≠clicos</li>
                                <li><strong>Liquidez:</strong> Manter 10-15% em ativos com liquidez D+1</li>
                            </ul>
                        </div>
                        <div>
                            <h5 style="color: #EC7000; margin-bottom: 0.75rem;">A√ß√µes Reativas:</h5>
                            <ul style="font-size: 0.9rem;">
                                <li><strong>Hedge:</strong> Contratos de CDS em setores concentrados</li>
                                <li><strong>Oportunidades:</strong> Aproveitar dislocamentos para entrada</li>
                                <li><strong>Monitoramento:</strong> Alertas autom√°ticos de deteriora√ß√£o</li>
                                <li><strong>Comunica√ß√£o:</strong> Transpar√™ncia total com investidores</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Resumo e Pr√≥ximos Passos -->
        <div class="section" id="section-summary">
            <div class="alert">
                <h4>‚ö†Ô∏è Modelo Te√≥rico</h4>
                <p>Valores ilustrativos para fins educacionais</p>
            </div>       

            <div class="section-header">
                <div class="section-number">5</div>
                <h2>Aplica√ß√£o Pr√°tica e Pr√≥ximos Passos</h2>
            </div>
            
            <h3>üìã Checklist para An√°lise de Migra√ß√£o e Stress</h3>
            <div class="grid">
                <div class="card">
                    <h4>1. An√°lise Inicial</h4>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 100%"></div>
                    </div>
                    <ul>
                        <li>Mapear ratings atuais</li>
                        <li>Identificar tend√™ncias setoriais</li>
                        <li>Calcular probabilidades</li>
                        <li>Avaliar concentra√ß√µes</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>2. Stress Test</h4>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 85%"></div>
                    </div>
                    <ul>
                        <li>Cen√°rios de stress</li>
                        <li>Impacto no portf√≥lio</li>
                        <li>Monte Carlo</li>
                        <li>Planos de conting√™ncia</li>
                    </ul>
                </div>
                <div class="card">
                    <h4>3. Implementa√ß√£o</h4>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 60%"></div>
                    </div>
                    <ul>
                        <li>Definir triggers</li>
                        <li>Setup monitoramento</li>
                        <li>Executar estrat√©gia</li>
                        <li>Monitorar resultados</li>
                    </ul>
                </div>
            </div>
            
            <div class="commercial-tip">
                <h4>Mensagem Final para o Cliente</h4>
                <p>"Com estas ferramentas avan√ßadas, conseguimos n√£o apenas <strong>proteger</strong> seu patrim√¥nio contra downgrades e crises sist√™micas, mas tamb√©m <strong>capturar oportunidades</strong> de upgrades e riding the curve. Nossa expertise em cr√©dito privado permite uma gest√£o ativa e sofisticada, maximizando seus retornos ajustados ao risco atrav√©s de an√°lise quantitativa robusta."</p>
                
                <div style="margin-top: 2rem; padding: 2rem; background: rgba(166, 207, 46, 0.1); border-radius: 10px; border: 1px solid rgba(166, 207, 46, 0.3);">
                    <h5 style="color: #A6CF2E; margin-bottom: 1rem;">Vantagens Competitivas:</h5>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <ul style="font-size: 0.9rem;">
                            <li><strong>An√°lise Quantitativa:</strong> Modelos propriet√°rios de stress</li>
                            <li><strong>Monitoramento 24/7:</strong> Alertas autom√°ticos de deteriora√ß√£o</li>
                            <li><strong>Gest√£o Ativa:</strong> Rebalanceamento din√¢mico da carteira</li>
                        </ul>
                        <ul style="font-size: 0.9rem;">
                            <li><strong>Gest√£o de Risco:</strong> Stress test multidimensional</li>
                            <li><strong>Sele√ß√£o Premium:</strong> Due diligence diferenciada</li>
                            <li><strong>Alpha Generation:</strong> Strategies de riding the curve</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configura√ß√µes de cores para Chart.js no tema escuro
        Chart.defaults.color = '#ffffff';
        Chart.defaults.borderColor = 'rgba(166, 207, 46, 0.2)';
        
        // Dados de spread por rating
        const spreadByRating = {
            'AAA': 50,
            'AA': 80,
            'A': 120,
            'BBB': 200,
            'BB': 350,
            'B': 600
        };

        // Curva de juros base
        const baseCurve = {
            0.5: 3.50,
            1: 4.00,
            2: 4.80,
            3: 5.20,
            5: 6.00,
            7: 6.50,
            10: 7.00
        };

        // Dados dos setores para an√°lise setorial
        const sectorData = {
            agro: {
                base: { risk: 'Baixo', migration: 7.2, correlation: 0.45, risks: ['Clima', 'Commodities', 'Cambial'] },
                stress: { risk: 'M√©dio', migration: 14.8, correlation: 0.65, risks: ['Commodities', 'Liquidez', 'Exporta√ß√£o'] },
                crisis: { risk: 'Alto', migration: 32.1, correlation: 0.85, risks: ['Default', 'Liquidez', 'Sist√™mico'] }
            },
            infra: {
                base: { risk: 'Baixo', migration: 5.1, correlation: 0.35, risks: ['Regulat√≥rio', 'Pol√≠tico', 'Demanda'] },
                stress: { risk: 'M√©dio', migration: 11.5, correlation: 0.55, risks: ['Financiamento', 'Demanda', 'Pol√≠tico'] },
                crisis: { risk: 'M√©dio', migration: 22.5, correlation: 0.65, risks: ['Liquidez', 'Demanda', 'Pol√≠tico'] }
            },
            energia: {
                base: { risk: 'M√©dio', migration: 6.8, correlation: 0.55, risks: ['Commodities', 'Regulat√≥rio', 'ESG'] },
                stress: { risk: 'Alto', migration: 18.2, correlation: 0.75, risks: ['Pre√ßos', 'Liquidez', 'Transi√ß√£o'] },
                crisis: { risk: 'Alto', migration: 42.5, correlation: 0.90, risks: ['Sist√™mico', 'Liquidez', 'Demanda'] }
            },
            financeiro: {
                base: { risk: 'Baixo', migration: 4.8, correlation: 0.40, risks: ['Inadimpl√™ncia', 'Juros', 'Regulat√≥rio'] },
                stress: { risk: 'Alto', migration: 22.3, correlation: 0.85, risks: ['Credit', 'Liquidez', 'Sist√™mico'] },
                crisis: { risk: 'Alto', migration: 52.8, correlation: 0.95, risks: ['Sist√™mico', 'P√¢nico', 'Cont√°gio'] }
            },
            industrial: {
                base: { risk: 'M√©dio', migration: 9.1, correlation: 0.50, risks: ['Demanda', 'Custos', 'Competi√ß√£o'] },
                stress: { risk: 'Alto', migration: 19.8, correlation: 0.70, risks: ['Demanda', 'Financiamento', 'Custos'] },
                crisis: { risk: 'Alto', migration: 38.7, correlation: 0.85, risks: ['Demanda', 'Liquidez', 'Fal√™ncias'] }
            }
        };
        
        const strategies = {
            agro: {
                base: "Manter exposi√ß√£o balanceada com foco em ratings A/BBB de grandes cooperativas e traders.",
                stress: "Reduzir exposi√ß√£o a BB/B. Focar em cooperativas consolidadas e contratos com hedge.",
                crisis: "Posi√ß√£o defensiva. Apenas investment grade com garantias reais s√≥lidas."
            },
            infra: {
                base: "Aproveitar projetos estruturados com receita garantida e ratings AAA/AA.",
                stress: "Seletividade em ativos essenciais. Evitar projetos greenfield em BB/B.",
                crisis: "Foco em infraestrutura cr√≠tica com contratos de longo prazo e indexa√ß√£o."
            },
            energia: {
                base: "Balancear entre renov√°veis (crescimento) e tradicionais (yield).",
                stress: "Reduzir exposi√ß√£o a O&G. Priorizar gera√ß√£o regulada e contratos PPA.",
                crisis: "Apenas utilities reguladas AAA/AA. Evitar merchant e commodity exposure."
            },
            financeiro: {
                base: "Exposi√ß√£o seletiva a bancos m√©dios AAA/AA com funding est√°vel.",
                stress: "Apenas grandes bancos AAA. Evitar fintechs e cr√©dito especializado.",
                crisis: "Zero exposi√ß√£o sub-investment grade. Foco em big4 com liquidez."
            },
            industrial: {
                base: "Diversificar entre defensivos (alimentos) e c√≠clicos (siderurgia).",
                stress: "Focar em bens essenciais e empresas com baixa alavancagem.",
                crisis: "Apenas l√≠deres setoriais AAA/AA com posi√ß√£o de mercado dominante."
            }
        };

        // Vari√°veis para gr√°ficos
        let sectorChart = null;
        let spreadChart = null;
        let ridingCurveChart = null;
        let comparisonChart = null;
        let stressChart = null;
        let sectorStressChart = null;
        let monteCarloChart = null;

        // Estado global da aplica√ß√£o
        let appState = {
            portfolioComposition: {
                highGrade: 30,
                investGrade: 50,
                specGrade: 20
            },
            sectorComposition: {
                agro: 25,
                infra: 30,
                energia: 20,
                outros: 25
            },
            stressResults: {},
            monteCarloResults: {}
        };

        // ===== FUN√á√ïES DE UTILIDADE =====
        
        function smoothScrollTo(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
                // Adicionar efeito visual
                element.style.boxShadow = '0 0 30px rgba(166, 207, 46, 0.5)';
                setTimeout(() => {
                    element.style.boxShadow = '';
                }, 2000);
            }
        }

        function showLoadingSpinner(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = '<div class="loading"></div> Calculando...';
            }
        }

        function hideLoadingSpinner(elementId, originalContent) {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = originalContent;
            }
        }

        function resetAllSimulations() {
            // Reset Stress Test
            document.getElementById('highGradeSlider').value = 30;
            document.getElementById('investGradeSlider').value = 50;
            document.getElementById('specGradeSlider').value = 20;
            document.getElementById('avgDuration').value = 3;
            document.getElementById('portfolioValue').value = 50;
            
            // Reset setores
            document.getElementById('agroSlider').value = 25;
            document.getElementById('infraSlider').value = 30;
            document.getElementById('energiaSlider').value = 20;
            document.getElementById('outrosSlider').value = 25;
            
            // Reset outros simuladores
            document.getElementById('currentRating').value = 'A';
            document.getElementById('newRating').value = 'BBB';
            document.getElementById('duration').value = 3;
            
            document.getElementById('initialTerm').value = 5;
            document.getElementById('holdingPeriod').value = 1;
            document.getElementById('issuerRating').value = 'AA';
            
            // Atualizar interfaces
            updateStressPortfolio();
            updateSectorConcentration();
            calculateImpact();
            updateRidingCurve();
            updateSectorAnalysis();
            
            // Esconder resultados
            document.getElementById('stressTestResults').style.display = 'none';
            document.getElementById('optimalStrategy').style.display = 'none';
            document.getElementById('ridingComparison').style.display = 'none';
            
            alert('üîÑ Todos os simuladores foram resetados!');
        }

        // ===== MATRIZES DE TRANSI√á√ÉO =====
        
        function showDetail(from, to, probability) {
            const detail = document.getElementById('matrixDetail');
            const text = document.getElementById('detailText');
            
            let message = `Probabilidade de migra√ß√£o de ${from} para ${to}: ${probability}%\n\n`;
            
            if (from === to) {
                message += `Isso significa que ${probability}% dos emissores ${from} mant√™m seu rating ap√≥s 1 ano.`;
            } else if (spreadByRating[to] < spreadByRating[from]) {
                message += `Upgrade! Potencial de ganho de capital devido √† redu√ß√£o do spread de cr√©dito de ${spreadByRating[from] - spreadByRating[to]} bps.`;
            } else {
                message += `Downgrade. Poss√≠vel perda de capital devido ao aumento do spread de cr√©dito de +${spreadByRating[to] - spreadByRating[from]} bps.`;
            }
            
            text.textContent = message;
            detail.style.display = 'block';
        }

        function switchTab(tabName, element) {
            // Remove active de todas as abas
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Adiciona active na aba selecionada
            element.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            // Inicializar an√°lise setorial se necess√°rio
            if (tabName === 'pratica') {
                setTimeout(() => updateSectorAnalysis(), 100);
            }
        }

        // ===== AN√ÅLISE SETORIAL =====
        
        function updateSectorAnalysis() {
            const sector = document.getElementById('sectorSelect').value;
            const scenario = document.getElementById('scenarioSelect').value;
            const data = sectorData[sector][scenario];
            
            // Atualizar m√©tricas
            document.getElementById('sectorRisk').textContent = data.risk;
            document.getElementById('migrationProb').textContent = data.migration.toFixed(1) + '%';
            document.getElementById('correlationIndex').textContent = data.correlation.toFixed(2);
            
            // Atualizar indicadores de risco
            const risksContainer = document.getElementById('sectorRisks');
            risksContainer.innerHTML = '';
            data.risks.forEach(risk => {
                const span = document.createElement('span');
                span.className = 'stress-indicator stress-' + (data.risk === 'Alto' ? 'high' : data.risk === 'M√©dio' ? 'medium' : 'low');
                span.textContent = risk;
                risksContainer.appendChild(span);
            });
            
            // Atualizar estrat√©gia
            document.getElementById('sectorStrategy').textContent = strategies[sector][scenario];
            
            // Atualizar cor da m√©trica de risco
            const riskElement = document.getElementById('sectorRisk');
            if (data.risk === 'Alto') {
                riskElement.style.color = '#ff6464';
            } else if (data.risk === 'M√©dio') {
                riskElement.style.color = '#EC7000';
            } else {
                riskElement.style.color = '#A6CF2E';
            }
            
            // Criar gr√°fico setorial
            createSectorChart(sector, scenario);
        }
        
        function createSectorChart(sector, scenario) {
            const ctx = document.getElementById('sectorChart').getContext('2d');
            
            if (sectorChart) {
                sectorChart.destroy();
            }
            
            // Dados simulados de migra√ß√£o por rating para o setor
            const migrationData = {
                agro: {
                    base: [1.5, 4, 7, 11, 16, 23],
                    stress: [4, 9, 14, 22, 32, 42],
                    crisis: [12, 22, 32, 47, 62, 77]
                },
                infra: {
                    base: [0.8, 2.5, 5, 8, 13, 18],
                    stress: [2.5, 7, 11, 18, 28, 38],
                    crisis: [8, 16, 23, 33, 48, 63]
                },
                energia: {
                    base: [1.2, 3.5, 6, 9.5, 15, 22],
                    stress: [5, 12, 18, 28, 42, 58],
                    crisis: [15, 28, 42, 58, 75, 87]
                },
                financeiro: {
                    base: [0.5, 1.8, 4.5, 7.5, 14, 21],
                    stress: [6, 13, 22, 37, 52, 67],
                    crisis: [22, 37, 52, 67, 82, 92]
                },
                industrial: {
                    base: [1.8, 5.5, 9, 14, 20, 28],
                    stress: [5.5, 11, 18, 28, 42, 57],
                    crisis: [13, 23, 33, 48, 67, 82]
                }
            };
            
            sectorChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['AAA', 'AA', 'A', 'BBB', 'BB', 'B'],
                    datasets: [{
                        label: 'Prob. Migra√ß√£o Negativa (%)',
                        data: migrationData[sector][scenario],
                        backgroundColor: function(context) {
                            const value = context.parsed.y;
                            if (value < 10) return 'rgba(166, 207, 46, 0.7)';
                            if (value < 25) return 'rgba(236, 112, 0, 0.7)';
                            return 'rgba(255, 100, 100, 0.7)';
                        },
                        borderColor: function(context) {
                            const value = context.parsed.y;
                            if (value < 10) return '#A6CF2E';
                            if (value < 25) return '#EC7000';
                            return '#ff6464';
                        },
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: `Migra√ß√£o Negativa - ${sector.charAt(0).toUpperCase() + sector.slice(1)} (${scenario})`,
                            color: '#A6CF2E',
                            font: { size: 16, weight: 'bold' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Probabilidade (%)',
                                color: '#ffffff'
                            },
                            ticks: { color: '#ffffff' },
                            grid: { color: 'rgba(166, 207, 46, 0.1)' }
                        },
                        x: {
                            ticks: { color: '#ffffff' },
                            grid: { color: 'rgba(166, 207, 46, 0.1)' }
                        }
                    }
                }
            });
        }

        // ===== FUN√á√ïES DE PREMISSAS =====
        
        function togglePremissas() {
            const premissas = document.getElementById('premissasModelo');
            if (premissas.style.display === 'none' || premissas.style.display === '') {
                premissas.style.display = 'block';
                premissas.scrollIntoView({ behavior: 'smooth' });
            } else {
                premissas.style.display = 'none';
            }
        }

        // ===== IMPACTO NA MARCA√á√ÉO =====
        
        function calculateImpact() {
            const current = document.getElementById('currentRating').value;
            const newRating = document.getElementById('newRating').value;
            const duration = parseFloat(document.getElementById('duration').value);
            
            const spreadChange = spreadByRating[newRating] - spreadByRating[current];
            const priceImpact = -(spreadChange / 10000) * duration * 100;
            
            document.getElementById('priceImpact').textContent = priceImpact.toFixed(1) + '%';
            document.getElementById('spreadChange').textContent = 
                spreadChange > 0 ? `üìà Aumento de spread: +${spreadChange} bps` : 
                `üìâ Redu√ß√£o de spread: ${spreadChange} bps`;
            
            // Atualizar cor baseado no impacto
            const impactElement = document.getElementById('priceImpact');
            if (priceImpact < 0) {
                impactElement.style.color = '#EC7000';
            } else {
                impactElement.style.color = '#A6CF2E';
            }
            
            updateSpreadChart();
        }

        function updateDuration() {
            const duration = document.getElementById('duration').value;
            document.getElementById('durationValue').textContent = duration;
            calculateImpact();
        }

        function updateSpreadChart() {
            const ctx = document.getElementById('spreadChart').getContext('2d');
            
            if (spreadChart) {
                spreadChart.destroy();
            }
            
            const current = document.getElementById('currentRating').value;
            const newRating = document.getElementById('newRating').value;
            
            // Criar curva de spread
            const ratings = ['AAA', 'AA', 'A', 'BBB', 'BB', 'B'];
            const spreads = ratings.map(r => spreadByRating[r]);
            
            spreadChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ratings,
                    datasets: [{
                        label: 'Curva de Spread',
                        data: spreads,
                        borderColor: '#A6CF2E',
                        backgroundColor: 'rgba(166, 207, 46, 0.1)',
                        tension: 0.4,
                        pointRadius: 8,
                        pointBackgroundColor: function(context) {
                            const rating = ratings[context.dataIndex];
                            if (rating === current) return '#EC7000';
                            if (rating === newRating) return '#A6CF2E';
                            return '#ffffff';
                        },
                        pointBorderColor: function(context) {
                            const rating = ratings[context.dataIndex];
                            if (rating === current) return '#EC7000';
                            if (rating === newRating) return '#A6CF2E';
                            return '#ffffff';
                        },
                        pointBorderWidth: function(context) {
                            const rating = ratings[context.dataIndex];
                            return (rating === current || rating === newRating) ? 3 : 2;
                        }
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Curva de Spread por Rating',
                            color: '#A6CF2E',
                            font: { size: 16, weight: 'bold' }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Spread (bps)',
                                color: '#ffffff'
                            },
                            ticks: { color: '#ffffff' },
                            grid: { color: 'rgba(166, 207, 46, 0.1)' }
                        },
                        x: {
                            ticks: { color: '#ffffff' },
                            grid: { color: 'rgba(166, 207, 46, 0.1)' }
                        }
                    }
                }
            });
        }

        // ===== RIDING THE CURVE =====
        
        function interpolateRate(term) {
            const terms = Object.keys(baseCurve).map(Number).sort((a, b) => a - b);
            
            if (baseCurve[term]) return baseCurve[term];
            
            for (let i = 0; i < terms.length - 1; i++) {
                if (term > terms[i] && term < terms[i + 1]) {
                    const t1 = terms[i];
                    const t2 = terms[i + 1];
                    const r1 = baseCurve[t1];
                    const r2 = baseCurve[t2];
                    return r1 + (r2 - r1) * (term - t1) / (t2 - t1);
                }
            }
            
            return terms[terms.length - 1] < term ? baseCurve[terms[terms.length - 1]] : baseCurve[terms[0]];
        }

        function updateHoldingOptions() {
            const initialTerm = parseFloat(document.getElementById('initialTerm').value);
            const holdingSelect = document.getElementById('holdingPeriod');
            
            // Limpar op√ß√µes
            holdingSelect.innerHTML = '';
            
            // Adicionar op√ß√µes v√°lidas
            const options = [0.5, 1, 1.5, 2, 3, 4, 5, 6, 7, 8, 9];
            options.forEach(holding => {
                if (holding < initialTerm) {
                    const option = document.createElement('option');
                    option.value = holding;
                    option.textContent = holding >= 1 ? `${holding} ano${holding > 1 ? 's' : ''}` : '6 meses';
                    holdingSelect.appendChild(option);
                }
            });
            
            // Selecionar valor padr√£o
            if (holdingSelect.children.length > 0) {
                holdingSelect.value = holdingSelect.children[0].value;
            }
        }

        function updateRidingCurve() {
            const initialTerm = parseFloat(document.getElementById('initialTerm').value);
            const holding = parseFloat(document.getElementById('holdingPeriod').value);
            const rating = document.getElementById('issuerRating').value;
            
            const finalTerm = initialTerm - holding;
            const spread = spreadByRating[rating];
            
            // Calcular taxas
            const initialRate = interpolateRate(initialTerm) + spread / 100;
            const finalRate = interpolateRate(finalTerm) + spread / 100;
            
            // Calcular retornos
            const carryReturn = (initialRate * holding).toFixed(1);
            const rolldownGain = ((initialRate - finalRate) * (finalTerm / initialTerm) * 100).toFixed(1);
            const totalReturn = (parseFloat(carryReturn) + parseFloat(rolldownGain)).toFixed(1);
            
            // Atualizar interface
            document.getElementById('carryReturn').textContent = `+${carryReturn}%`;
            document.getElementById('rolldownGain').textContent = `+${rolldownGain}%`;
            document.getElementById('totalReturn').textContent = `+${totalReturn}%`;
            
            // Atualizar gr√°fico
            updateRidingChart(initialTerm, finalTerm, initialRate, finalRate, spread);
        }

        function updateRidingChart(initialTerm, finalTerm, initialRate, finalRate, spread) {
            const ctx = document.getElementById('ridingCurveChart').getContext('2d');
            
            if (ridingCurveChart) {
                ridingCurveChart.destroy();
            }
            
            // Criar pontos da curva
            const terms = [0.5, 1, 2, 3, 5, 7, 10];
            const rates = terms.map(t => interpolateRate(t) + spread / 100);
            
            ridingCurveChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: terms.map(t => `${t}a`),
                    datasets: [{
                        label: 'Curva de Juros + Spread',
                        data: rates,
                        borderColor: '#A6CF2E',
                        backgroundColor: 'rgba(166, 207, 46, 0.1)',
                        tension: 0.4,
                        pointRadius: function(context) {
                            const term = terms[context.dataIndex];
                            if (Math.abs(term - initialTerm) < 0.1 || Math.abs(term - finalTerm) < 0.1) {
                                return 12;
                            }
                            return 6;
                        },
                        pointBackgroundColor: function(context) {
                            const term = terms[context.dataIndex];
                            if (Math.abs(term - initialTerm) < 0.1) return '#EC7000';
                            if (Math.abs(term - finalTerm) < 0.1) return '#A6CF2E';
                            return '#ffffff';
                        },
                        pointBorderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Estrat√©gia Riding the Curve',
                            color: '#A6CF2E',
                            font: { size: 16, weight: 'bold' }
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Taxa (%)',
                                color: '#ffffff'
                            },
                            ticks: { color: '#ffffff' },
                            grid: { color: 'rgba(166, 207, 46, 0.1)' }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Prazo',
                                color: '#ffffff'
                            },
                            ticks: { color: '#ffffff' },
                            grid: { color: 'rgba(166, 207, 46, 0.1)' }
                        }
                    }
                }
            });
        }

        function showOptimalStrategy() {
            const strategy = document.getElementById('optimalStrategy');
            if (strategy.style.display === 'none' || !strategy.style.display) {
                strategy.style.display = 'block';
                strategy.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            } else {
                strategy.style.display = 'none';
            }
        }

        function compareRidingStrategies() {
            const comparison = document.getElementById('ridingComparison');
            if (comparison.style.display === 'none' || !comparison.style.display) {
                comparison.style.display = 'block';
                updateStrategyHoldingOptions(1);
                updateStrategyHoldingOptions(2);
                updateStrategyHoldingOptions(3);
                comparison.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            } else {
                comparison.style.display = 'none';
            }
        }

        function updateStrategyHoldingOptions(strategyNum) {
            const initialTerm = parseFloat(document.getElementById(`strat${strategyNum}Term`).value);
            const holdingSelect = document.getElementById(`strat${strategyNum}Hold`);
            
            holdingSelect.innerHTML = '';
            
            const options = [0.5, 1, 1.5, 2, 3, 4, 5, 6, 7, 8, 9];
            options.forEach(holding => {
                if (holding < initialTerm) {
                    const option = document.createElement('option');
                    option.value = holding;
                    option.textContent = holding >= 1 ? `${holding} ano${holding > 1 ? 's' : ''}` : '6 meses';
                    holdingSelect.appendChild(option);
                }
            });
            
            if (holdingSelect.children.length > 0) {
                holdingSelect.value = holdingSelect.children[0].value;
            }
        }

        function runRidingComparison() {
            // Verificar se todos os campos est√£o preenchidos
            for (let i = 1; i <= 3; i++) {
                const term = document.getElementById(`strat${i}Term`);
                const hold = document.getElementById(`strat${i}Hold`);
                const rating = document.getElementById(`strat${i}Rating`);
                
                if (!term || !hold || !rating || !term.value || !hold.value || !rating.value) {
                    alert('Por favor, configure todas as 3 estrat√©gias antes de executar a compara√ß√£o.');
                    return;
                }
            }
            
            // Mostrar loading
            const resultsDiv = document.getElementById('ridingComparisonResults');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = '<div style="text-align: center; padding: 2rem;"><div class="loading"></div> <span style="color: #A6CF2E;">Executando an√°lise comparativa...</span></div>';
            
            setTimeout(() => {
                try {
                    const strategies = [];
                    
                    for (let i = 1; i <= 3; i++) {
                        const initialTerm = parseFloat(document.getElementById(`strat${i}Term`).value);
                        const holding = parseFloat(document.getElementById(`strat${i}Hold`).value);
                        const rating = document.getElementById(`strat${i}Rating`).value;
                        
                        if (holding >= initialTerm) {
                            alert(`Estrat√©gia ${i}: O per√≠odo de holding deve ser menor que o prazo inicial.`);
                            return;
                        }
                        
                        const finalTerm = initialTerm - holding;
                        const spread = spreadByRating[rating];
                        const initialRate = interpolateRate(initialTerm) + spread / 100;
                        const finalRate = interpolateRate(finalTerm) + spread / 100;
                        
                        const carryReturn = initialRate * holding;
                        const rolldownGain = (initialRate - finalRate) * (finalTerm / initialTerm) * 100;
                        const totalReturn = carryReturn + rolldownGain;
                        
                        strategies.push({
                            num: i,
                            config: `${initialTerm}a ‚Üí ${holding}a (${rating})`,
                            initialRate: initialRate.toFixed(2),
                            carry: carryReturn.toFixed(1),
                            rolldown: rolldownGain.toFixed(1),
                            total: totalReturn.toFixed(1),
                            ranking: 0
                        });
                    }
                    
                    // Ordenar por retorno total
                    strategies.sort((a, b) => parseFloat(b.total) - parseFloat(a.total));
                    strategies.forEach((s, index) => s.ranking = index + 1);
                    
                    // Restaurar conte√∫do da div
                    resultsDiv.innerHTML = `
                        <div class="chart-container">
                            <canvas id="comparisonChart"></canvas>
                        </div>
                        
                        <div class="matrix-container" style="margin-top: 2rem;">
                            <table class="transition-matrix" id="comparisonTable">
                                <thead>
                                    <tr>
                                        <th>Estrat√©gia</th>
                                        <th>Configura√ß√£o</th>
                                        <th>Taxa Inicial</th>
                                        <th>Carry</th>
                                        <th>Roll-Down</th>
                                        <th>Total</th>
                                        <th>Ranking</th>
                                    </tr>
                                </thead>
                                <tbody id="comparisonTableBody">
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="result-box" style="margin-top: 2rem;">
                            <h3>An√°lise Comparativa</h3>
                            <p id="comparisonAnalysis"></p>
                        </div>
                    `;
                    
                    // Atualizar tabela
                    const tbody = document.getElementById('comparisonTableBody');
                    tbody.innerHTML = '';
                    
                    strategies.forEach(s => {
                        const row = tbody.insertRow();
                        const medals = ['ü•á', 'ü•à', 'ü•â'];
                        row.innerHTML = `
                            <td style="font-weight: bold;">Estrat√©gia ${s.num}</td>
                            <td>${s.config}</td>
                            <td>${s.initialRate}%</td>
                            <td style="color: #A6CF2E;">+${s.carry}%</td>
                            <td style="color: #EC7000;">+${s.rolldown}%</td>
                            <td style="color: #A6CF2E; font-weight: bold;">+${s.total}%</td>
                            <td style="font-weight: bold;">${medals[s.ranking - 1]}</td>
                        `;
                        
                        if (s.ranking === 1) {
                            row.style.background = 'rgba(166, 207, 46, 0.1)';
                            row.style.border = '2px solid #A6CF2E';
                        }
                    });
                    
                    // Criar gr√°fico de compara√ß√£o
                    createComparisonChart(strategies);
                    
                    // An√°lise
                    const best = strategies[0];
                    document.getElementById('comparisonAnalysis').textContent = 
                        `A Estrat√©gia ${best.num} apresentou o melhor desempenho com retorno total de +${best.total}%, ` +
                        `combinando carry de +${best.carry}% e roll-down de +${best.rolldown}%.`;
                    
                    resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    
                } catch (error) {
                    console.error('Erro na compara√ß√£o:', error);
                    resultsDiv.innerHTML = '<div style="text-align: center; padding: 2rem; color: #EC7000;">Erro ao executar compara√ß√£o. Verifique os par√¢metros.</div>';
                }
            }, 1500);
        }

        function createComparisonChart(strategies) {
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            
            if (comparisonChart) {
                comparisonChart.destroy();
            }
            
            comparisonChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: strategies.map(s => `Estrat√©gia ${s.num}`),
                    datasets: [
                        {
                            label: 'Carry',
                            data: strategies.map(s => parseFloat(s.carry)),
                            backgroundColor: 'rgba(166, 207, 46, 0.7)',
                            borderColor: '#A6CF2E',
                            borderWidth: 2
                        },
                        {
                            label: 'Roll-Down',
                            data: strategies.map(s => parseFloat(s.rolldown)),
                            backgroundColor: 'rgba(236, 112, 0, 0.7)',
                            borderColor: '#EC7000',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Compara√ß√£o de Estrat√©gias Riding the Curve',
                            color: '#A6CF2E',
                            font: { size: 16, weight: 'bold' }
                        },
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#ffffff'
                            }
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            ticks: { color: '#ffffff' },
                            grid: { color: 'rgba(166, 207, 46, 0.1)' }
                        },
                        y: {
                            stacked: true,
                            title: {
                                display: true,
                                text: 'Retorno (%)',
                                color: '#ffffff'
                            },
                            ticks: { color: '#ffffff' },
                            grid: { color: 'rgba(166, 207, 46, 0.1)' }
                        }
                    }
                }
            });
        }

        function closeRidingComparison() {
            document.getElementById('ridingComparison').style.display = 'none';
        }

        // ===== STRESS TEST AVAN√áADO =====
        
        function updateStressPortfolio() {
            let highGrade = parseInt(document.getElementById('highGradeSlider').value);
            let investGrade = parseInt(document.getElementById('investGradeSlider').value);
            let specGrade = parseInt(document.getElementById('specGradeSlider').value);
            
            // Normalizar para 100%
            const total = highGrade + investGrade + specGrade;
            if (total !== 100) {
                const factor = 100 / total;
                highGrade = Math.round(highGrade * factor);
                investGrade = Math.round(investGrade * factor);
                specGrade = 100 - highGrade - investGrade;
            }
            
            // Atualizar os percentuais
            document.getElementById('highGradePerc').textContent = `${highGrade}%`;
            document.getElementById('investGradePerc').textContent = `${investGrade}%`;
            document.getElementById('specGradePerc').textContent = `${specGrade}%`;
            
            // Atualizar sliders
            document.getElementById('highGradeSlider').value = highGrade;
            document.getElementById('investGradeSlider').value = investGrade;
            document.getElementById('specGradeSlider').value = specGrade;
            
            // Atualizar estado global
            appState.portfolioComposition = { highGrade, investGrade, specGrade };
            
            // Calcular spread m√©dio
            const weightedSpread = (highGrade * 65 + investGrade * 160 + specGrade * 475) / 100;
            document.getElementById('currentSpread').value = `${Math.round(weightedSpread)} bps`;
            
            // Atualizar gr√°ficos se existirem
            if (stressChart && document.getElementById('stressTestResults').style.display === 'block') {
                createStressChart();
                createSectorStressChart();
            }
        }

        function updateSectorConcentration() {
            let agro = parseInt(document.getElementById('agroSlider').value);
            let infra = parseInt(document.getElementById('infraSlider').value);
            let energia = parseInt(document.getElementById('energiaSlider').value);
            let outros = parseInt(document.getElementById('outrosSlider').value);
            
            // Normalizar para 100%
            const total = agro + infra + energia + outros;
            if (total !== 100) {
                const factor = 100 / total;
                agro = Math.round(agro * factor);
                infra = Math.round(infra * factor);
                energia = Math.round(energia * factor);
                outros = 100 - agro - infra - energia;
            }
            
            // Atualizar percentuais
            document.getElementById('agroPerc').textContent = `${agro}%`;
            document.getElementById('infraPerc').textContent = `${infra}%`;
            document.getElementById('energiaPerc').textContent = `${energia}%`;
            document.getElementById('outrosPerc').textContent = `${outros}%`;
            
            // Atualizar sliders
            document.getElementById('agroSlider').value = agro;
            document.getElementById('infraSlider').value = infra;
            document.getElementById('energiaSlider').value = energia;
            document.getElementById('outrosSlider').value = outros;
            
            // Atualizar estado global
            appState.sectorComposition = { agro, infra, energia, outros };
            
            // Atualizar gr√°fico setorial se existir
            if (sectorStressChart && document.getElementById('stressTestResults').style.display === 'block') {
                createSectorStressChart();
            }
        }

        function runAdvancedStressTest() {
            showLoadingSpinner('conservadorImpact', '-2.5%');
            showLoadingSpinner('moderadoImpact', '-7.8%');
            showLoadingSpinner('panicoImpact', '-18.5%');
            
            setTimeout(() => {
                const portfolio = appState.portfolioComposition;
                const sectors = appState.sectorComposition;
                const duration = parseFloat(document.getElementById('avgDuration').value);
                const portfolioValue = parseFloat(document.getElementById('portfolioValue').value);
                
                // Cen√°rios de stress avan√ßados
                const scenarios = {
                    conservador: {
                        name: 'Conservador',
                        spreadIncrease: 50 + (portfolio.specGrade * 0.5), // Ajuste por composi√ß√£o
                        downgrades: 10 + (portfolio.specGrade * 0.2),
                        defaults: 0.5 + (portfolio.specGrade * 0.1),
                        migrationFactor: 1.2 + (sectors.energia * 0.01), // Ajuste setorial
                        correlationBoost: 0.1
                    },
                    moderado: {
                        name: 'Moderado',
                        spreadIncrease: 150 + (portfolio.specGrade * 1.5),
                        downgrades: 25 + (portfolio.specGrade * 0.8),
                        defaults: 2.5 + (portfolio.specGrade * 0.3),
                        migrationFactor: 2.5 + (sectors.energia * 0.02),
                        correlationBoost: 0.3
                    },
                    panico: {
                        name: 'P√¢nico',
                        spreadIncrease: 400 + (portfolio.specGrade * 3.0),
                        downgrades: 50 + (portfolio.specGrade * 1.5),
                        defaults: 8.0 + (portfolio.specGrade * 0.6),
                        migrationFactor: 5.0 + (sectors.energia * 0.03),
                        correlationBoost: 0.7
                    }
                };
                
                // Calcular impactos para cada cen√°rio
                Object.keys(scenarios).forEach(scenarioName => {
                    const scenario = scenarios[scenarioName];
                    
                    // Impacto do spread (duration * spread change)
                    const spreadImpact = -(scenario.spreadIncrease / 10000) * duration * 100;
                    
                    // Impacto de defaults (taxa de default * (1 - recovery))
                    const defaultImpact = -(scenario.defaults / 100) * 60; // 40% recovery
                    
                    // Impacto de migra√ß√£o (probabilidade * impacto m√©dio)
                    const migrationImpact = -(scenario.downgrades / 100) * 2.5; // Impacto m√©dio de downgrade
                    
                    // Impacto de correla√ß√£o setorial
                    const correlationImpact = -(scenario.correlationBoost * 2);
                    
                    // Impacto total
                    const totalImpact = spreadImpact + defaultImpact + migrationImpact + correlationImpact;
                    
                    // VaR calculado com distribui√ß√£o normal
                    const volatility = Math.abs(totalImpact) * 0.6; // Aproxima√ß√£o de volatilidade
                    const var95 = totalImpact + (1.645 * volatility); // 95% confidence
                    
                    // Atualizar interface
                    document.getElementById(`${scenarioName}Impact`).textContent = `${totalImpact.toFixed(1)}%`;
                    document.getElementById(`${scenarioName}Spread`).textContent = `+${Math.round(scenario.spreadIncrease)}bps`;
                    document.getElementById(`${scenarioName}Downgrade`).textContent = `${scenario.downgrades.toFixed(1)}%`;
                    document.getElementById(`${scenarioName}Default`).textContent = `${scenario.defaults.toFixed(1)}%`;
                    document.getElementById(`${scenarioName}VaR`).textContent = `${var95.toFixed(1)}%`;
                    
                    // Atualizar barra de progresso
                    const progressPercent = Math.min(Math.abs(totalImpact) * 5, 100);
                    document.getElementById(`${scenarioName}Progress`).style.width = `${progressPercent}%`;
                    
                    // Salvar no estado global
                    appState.stressResults[scenarioName] = {
                        totalImpact,
                        spreadImpact,
                        defaultImpact,
                        migrationImpact,
                        correlationImpact,
                        var95,
                        scenario
                    };
                });
                
                // Mostrar resultados
                document.getElementById('stressTestResults').style.display = 'block';
                
                // Criar gr√°ficos
                createStressChart();
                createSectorStressChart();
                
                // An√°lise detalhada
                generateStressAnalysis();
                
                // Scroll para resultados
                document.getElementById('stressTestResults').scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
            }, 2000);
        }

        function createStressChart() {
            const ctx = document.getElementById('stressChart').getContext('2d');
            
            if (stressChart) {
                stressChart.destroy();
            }
            
            const impacts = [
                appState.stressResults.conservador.totalImpact,
                appState.stressResults.moderado.totalImpact,
                appState.stressResults.panico.totalImpact
            ];
            
            stressChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Conservador', 'Moderado', 'Severo'],
                    datasets: [{
                        label: 'Impacto na Carteira (%)',
                        data: impacts.map(Math.abs),
                        backgroundColor: [
                            'rgba(166, 207, 46, 0.7)',
                            'rgba(236, 112, 0, 0.7)',
                            'rgba(255, 100, 100, 0.7)'
                        ],
                        borderColor: [
                            '#A6CF2E',
                            '#EC7000',
                            '#ff6464'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Impacto dos Cen√°rios de Stress',
                            color: '#A6CF2E',
                            font: { size: 16, weight: 'bold' }
                        }
                    },
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Impacto (%)',
                                color: '#ffffff'
                            },
                            ticks: { color: '#ffffff' },
                            grid: { color: 'rgba(166, 207, 46, 0.1)' }
                        },
                        x: {
                            ticks: { color: '#ffffff' },
                            grid: { color: 'rgba(166, 207, 46, 0.1)' }
                        }
                    }
                }
            });
        }

        function createSectorStressChart() {
            const ctx = document.getElementById('sectorStressChart').getContext('2d');
            
            if (sectorStressChart) {
                sectorStressChart.destroy();
            }
            
            // Usar composi√ß√£o real da carteira
            const sectors = appState.sectorComposition;
            
            // Calcular impacto por setor baseado na composi√ß√£o atual e cen√°rio moderado
            const sectorImpacts = {
                'Agroneg√≥cio': (sectors.agro / 100) * -6.2,
                'Infraestrutura': (sectors.infra / 100) * -4.8,
                'Energia': (sectors.energia / 100) * -9.1,
                'Outros': (sectors.outros / 100) * -7.5
            };
            
            // Filtrar setores com exposi√ß√£o > 0
            const labels = [];
            const data = [];
            const colors = [];
            const borderColors = [];
            
            Object.entries(sectorImpacts).forEach(([sector, impact]) => {
                if (Math.abs(impact) > 0.1) { // S√≥ mostrar se tiver impacto significativo
                    labels.push(sector);
                    data.push(Math.abs(impact));
                    
                    // Cores baseadas no setor
                    if (sector.includes('Agro')) {
                        colors.push('rgba(166, 207, 46, 0.8)');
                        borderColors.push('#A6CF2E');
                    } else if (sector.includes('Infra')) {
                        colors.push('rgba(236, 112, 0, 0.8)');
                        borderColors.push('#EC7000');
                    } else if (sector.includes('Energia')) {
                        colors.push('rgba(255, 100, 100, 0.8)');
                        borderColors.push('#ff6464');
                    } else {
                        colors.push('rgba(255, 255, 255, 0.6)');
                        borderColors.push('#ffffff');
                    }
                }
            });
            
            sectorStressChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderColor: borderColors,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#ffffff',
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: 'Impacto por Setor - Cen√°rio Moderado',
                            color: '#A6CF2E',
                            font: { size: 14, weight: 'bold' }
                        }
                    }
                }
            });
        }

        function generateStressAnalysis() {
            const results = appState.stressResults;
            const portfolio = appState.portfolioComposition;
            const portfolioValue = parseFloat(document.getElementById('portfolioValue').value);
            
            let analysis = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div>
                        <h5 style="color: #A6CF2E; margin-bottom: 0.75rem;">Composi√ß√£o da Carteira:</h5>
                        <ul style="font-size: 0.9rem;">
                            <li>Investment Grade: ${portfolio.highGrade + portfolio.investGrade}%</li>
                            <li>Speculative Grade: ${portfolio.specGrade}%</li>
                            <li>Valor Total: R$ ${portfolioValue} Mi</li>
                            <li>Duration M√©dia: ${document.getElementById('avgDuration').value} anos</li>
                        </ul>
                    </div>
                    <div>
                        <h5 style="color: #EC7000; margin-bottom: 0.75rem;">M√©tricas de Risco:</h5>
                        <ul style="font-size: 0.9rem;">
                            <li>VaR M√©dio 95%: ${((results.conservador.var95 + results.moderado.var95 + results.panico.var95) / 3).toFixed(1)}%</li>
                            <li>Default Esperado: ${((results.conservador.scenario.defaults + results.moderado.scenario.defaults + results.panico.scenario.defaults) / 3).toFixed(1)}%</li>
                            <li>Spread Stress: ${((results.conservador.scenario.spreadIncrease + results.moderado.scenario.spreadIncrease + results.panico.scenario.spreadIncrease) / 3).toFixed(0)} bps</li>
                            <li>Correla√ß√£o Sist√™mica: ${portfolio.specGrade > 30 ? 'Alta' : portfolio.specGrade > 15 ? 'M√©dia' : 'Baixa'}</li>
                        </ul>
                    </div>
                </div>
            `;
            
            document.getElementById('stressAnalysisDetail').innerHTML = analysis;
            
            // Conclus√µes principais
            const conclusions = [
                `A carteira apresenta ${portfolio.specGrade > 25 ? 'alta' : portfolio.specGrade > 15 ? 'm√©dia' : 'baixa'} exposi√ß√£o a ativos especulativos (${portfolio.specGrade}%)`,
                `Perda m√°xima estimada no cen√°rio severo: R$ ${(portfolioValue * Math.abs(results.panico.totalImpact) / 100).toFixed(1)} Mi`,
                `Tempo estimado de recupera√ß√£o: ${Math.abs(results.moderado.totalImpact) > 10 ? '18-24' : Math.abs(results.moderado.totalImpact) > 5 ? '12-18' : '6-12'} meses`,
                `Recomenda-se ${portfolio.specGrade > 20 ? 'reduzir exposi√ß√£o especulativa' : 'manter composi√ß√£o atual'} para otimizar o perfil de risco`
            ];
            
            const conclusionsList = document.getElementById('stressConclusions');
            conclusionsList.innerHTML = '';
            conclusions.forEach(conclusion => {
                const li = document.createElement('li');
                li.textContent = conclusion;
                li.style.marginBottom = '0.5rem';
                conclusionsList.appendChild(li);
            });
        }

        function runMonteCarloSimulation() {
            showLoadingSpinner('monteCarloVaR95', '-5.2%');
            
            setTimeout(() => {
                const numSims = parseInt(document.getElementById('monteCarloSims').value);
                const horizon = parseInt(document.getElementById('monteCarloHorizon').value);
                
                // Simula√ß√£o Monte Carlo simplificada
                const returns = [];
                const portfolio = appState.portfolioComposition;
                
                for (let i = 0; i < numSims; i++) {
                    // Fatores de risco aleat√≥rios
                    const spreadShock = (Math.random() - 0.5) * 300; // ¬±150bps
                    const defaultRate = Math.random() * 0.05 * (portfolio.specGrade / 20); // Baseado em spec grade
                    const correlationFactor = Math.random() * 0.3;
                    
                    // C√°lculo do retorno
                    const spreadImpact = -(spreadShock / 10000) * parseFloat(document.getElementById('avgDuration').value) * 100;
                    const defaultImpact = -(defaultRate * 60); // 40% recovery
                    const correlationImpact = -(correlationFactor * 3);
                    
                    const totalReturn = spreadImpact + defaultImpact + correlationImpact;
                    returns.push(totalReturn);
                }
                
                // Ordenar retornos
                returns.sort((a, b) => a - b);
                
                // Calcular m√©tricas
                const var95 = returns[Math.floor(numSims * 0.05)];
                const var99 = returns[Math.floor(numSims * 0.01)];
                const expectedShortfall = returns.slice(0, Math.floor(numSims * 0.05))
                    .reduce((sum, r) => sum + r, 0) / Math.floor(numSims * 0.05);
                const probLoss5 = returns.filter(r => r < -5).length / numSims * 100;
                
                // Atualizar interface
                document.getElementById('monteCarloVaR95').textContent = `${var95.toFixed(1)}%`;
                document.getElementById('monteCarloVaR99').textContent = `${var99.toFixed(1)}%`;
                document.getElementById('monteCarloES').textContent = `${expectedShortfall.toFixed(1)}%`;
                document.getElementById('monteCarloProbLoss').textContent = `${probLoss5.toFixed(1)}%`;
                
                // Criar histograma
                createMonteCarloChart(returns);
                
                document.getElementById('monteCarloResults').style.display = 'block';
                
                // Salvar resultados
                appState.monteCarloResults = {
                    returns,
                    var95,
                    var99,
                    expectedShortfall,
                    probLoss5
                };
            }, 1500);
        }

        function createMonteCarloChart(returns) {
            const ctx = document.getElementById('monteCarloChart').getContext('2d');
            
            if (monteCarloChart) {
                monteCarloChart.destroy();
            }
            
            // Criar histograma
            const bins = 50;
            const min = Math.min(...returns);
            const max = Math.max(...returns);
            const binSize = (max - min) / bins;
            
            const histogram = new Array(bins).fill(0);
            const labels = [];
            
            returns.forEach(r => {
                const binIndex = Math.min(Math.floor((r - min) / binSize), bins - 1);
                histogram[binIndex]++;
            });
            
            for (let i = 0; i < bins; i++) {
                labels.push((min + i * binSize).toFixed(1));
            }
            
            monteCarloChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Frequ√™ncia',
                        data: histogram,
                        backgroundColor: function(context) {
                            const value = parseFloat(labels[context.dataIndex]);
                            if (value < -10) return 'rgba(255, 100, 100, 0.8)';
                            if (value < -5) return 'rgba(236, 112, 0, 0.8)';
                            if (value < 0) return 'rgba(255, 255, 255, 0.6)';
                            return 'rgba(166, 207, 46, 0.8)';
                        },
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Distribui√ß√£o de Retornos - Monte Carlo',
                            color: '#A6CF2E',
                            font: { size: 14, weight: 'bold' }
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Retorno (%)',
                                color: '#ffffff'
                            },
                            ticks: { 
                                color: '#ffffff',
                                maxTicksLimit: 10
                            },
                            grid: { color: 'rgba(166, 207, 46, 0.1)' }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Frequ√™ncia',
                                color: '#ffffff'
                            },
                            ticks: { color: '#ffffff' },
                            grid: { color: 'rgba(166, 207, 46, 0.1)' }
                        }
                    }
                }
            });
        }

        function resetStressTest() {
            // Reset sliders
            document.getElementById('highGradeSlider').value = 30;
            document.getElementById('investGradeSlider').value = 50;
            document.getElementById('specGradeSlider').value = 20;
            document.getElementById('avgDuration').value = 3;
            document.getElementById('portfolioValue').value = 50;
            
            document.getElementById('agroSlider').value = 25;
            document.getElementById('infraSlider').value = 30;
            document.getElementById('energiaSlider').value = 20;
            document.getElementById('outrosSlider').value = 25;
            
            // Atualizar interfaces
            updateStressPortfolio();
            updateSectorConcentration();
            
            // Esconder resultados
            document.getElementById('stressTestResults').style.display = 'none';
            document.getElementById('monteCarloResults').style.display = 'none';
            
            // Limpar estado
            appState.stressResults = {};
            appState.monteCarloResults = {};
            
            alert('Stress Test resetado com sucesso!');
        }

        function exportStressResults() {
            if (Object.keys(appState.stressResults).length === 0) {
                alert('Execute o Stress Test primeiro!');
                return;
            }
            
            const results = appState.stressResults;
            const portfolio = appState.portfolioComposition;
            const portfolioValue = parseFloat(document.getElementById('portfolioValue').value);
            
            let report = `RELAT√ìRIO DE STRESS TEST - ION CAPITAL\n`;
            report += `Data: ${new Date().toLocaleDateString('pt-BR')}\n\n`;
            
            report += `COMPOSI√á√ÉO DA CARTEIRA:\n`;
            report += `‚Ä¢ Investment Grade (AAA-BBB): ${portfolio.highGrade + portfolio.investGrade}%\n`;
            report += `‚Ä¢ Speculative Grade (BB-B): ${portfolio.specGrade}%\n`;
            report += `‚Ä¢ Valor Total: R$ ${portfolioValue} Mi\n`;
            report += `‚Ä¢ Duration M√©dia: ${document.getElementById('avgDuration').value} anos\n\n`;
            
            report += `RESULTADOS POR CEN√ÅRIO:\n`;
            Object.keys(results).forEach(scenario => {
                const r = results[scenario];
                report += `\n${scenario.toUpperCase()}:\n`;
                report += `‚Ä¢ Impacto Total: ${r.totalImpact.toFixed(1)}%\n`;
                report += `‚Ä¢ VaR 95%: ${r.var95.toFixed(1)}%\n`;
                report += `‚Ä¢ Spread Stress: +${Math.round(r.scenario.spreadIncrease)}bps\n`;
                report += `‚Ä¢ Taxa de Default: ${r.scenario.defaults.toFixed(1)}%\n`;
            });
            
            if (appState.monteCarloResults.var95) {
                const mc = appState.monteCarloResults;
                report += `\nSIMULA√á√ÉO MONTE CARLO:\n`;
                report += `‚Ä¢ VaR 95%: ${mc.var95.toFixed(1)}%\n`;
                report += `‚Ä¢ VaR 99%: ${mc.var99.toFixed(1)}%\n`;
                report += `‚Ä¢ Expected Shortfall: ${mc.expectedShortfall.toFixed(1)}%\n`;
                report += `‚Ä¢ Prob. Perda > 5%: ${mc.probLoss5.toFixed(1)}%\n`;
            }
            
            // Criar arquivo para download
            const blob = new Blob([report], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `stress_test_ion_${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            alert('Relat√≥rio exportado com sucesso!');
        }

        // ===== INICIALIZA√á√ÉO =====
        
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar simuladores
            updateHoldingOptions();
            updateRidingCurve();
            calculateImpact();
            updateSectorAnalysis();
            updateStressPortfolio();
            updateSectorConcentration();
            
            console.log('Sistema de An√°lise de Cr√©dito ION inicializado com sucesso!');
        });
    </script>
</body>
</html>