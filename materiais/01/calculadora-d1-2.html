<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulador Interativo - PU Curva vs PU Indicativo</title>
<style>
:root {
  --laranja: #EC7000;
  --verde: #A6CF2E;
  --azul-escuro: #091B1E;
  --azul-medio: #133134;
  --branco: #FFFFFF;
  --cinza: #999999;
  --vermelho: #FF4D4D;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
}

body {
  background-color: var(--azul-escuro);
  color: var(--branco);
}

.container {
  max-width: 1000px;
  margin: 0 auto;
  padding: 20px;
}

header {
  text-align: center;
  margin-bottom: 20px;
}

h1 {
  color: var(--laranja);
  font-size: 28px;
  margin-bottom: 10px;
}

.painel {
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-gap: 20px;
}

.card {
  background-color: var(--azul-medio);
  border-radius: 10px;
  padding: 20px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

h2 {
  color: var(--verde);
  font-size: 20px;
  margin-bottom: 15px;
}

.slider-grupo {
  margin-bottom: 15px;
}

.slider-grupo label {
  display: block;
  color: var(--verde);
  font-size: 14px;
  margin-bottom: 8px;
}

.slider-info {
  display: flex;
  justify-content: space-between;
  margin-bottom: 5px;
  font-size: 12px;
  color: var(--cinza);
}

.slider-valor {
  color: var(--laranja);
  font-weight: bold;
}

input[type="range"] {
  width: 100%;
  height: 6px;
  border-radius: 3px;
  background: rgba(0, 0, 0, 0.3);
  outline: none;
  -webkit-appearance: none;
}

input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: var(--verde);
  cursor: pointer;
}

button {
  background: var(--laranja);
  color: white;
  border: none;
  padding: 12px;
  border-radius: 5px;
  font-weight: bold;
  cursor: pointer;
  width: 100%;
  margin-top: 10px;
  transition: background 0.3s;
}

button:hover {
  background: #D56500;
}

.resultados {
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-gap: 10px;
  margin-bottom: 20px;
}

.resultado-item {
  background: rgba(0, 0, 0, 0.2);
  padding: 10px;
  border-radius: 5px;
}

.resultado-label {
  font-size: 12px;
  color: var(--cinza);
  margin-bottom: 5px;
}

.resultado-valor {
  font-size: 16px;
  font-weight: bold;
  color: var(--verde);
}

.valor-negativo {
  color: var(--vermelho);
}

.grafico-container {
  height: 300px;
  position: relative;
  margin-top: 20px;
  margin-bottom: 30px;
  background: rgba(0, 0, 0, 0.2);
  border-radius: 8px;
  padding: 10px;
}

.grafico {
  position: absolute;
  left: 60px;
  bottom: 40px;
  width: calc(100% - 70px);
  height: calc(100% - 50px);
}

.eixo-x, .eixo-y {
  position: absolute;
  background: rgba(255, 255, 255, 0.5);
}

.eixo-x {
  left: 0;
  bottom: 0;
  width: 100%;
  height: 1px;
}

.eixo-y {
  left: 0;
  bottom: 0;
  width: 1px;
  height: 100%;
}

.barra-grupo {
  position: absolute;
  bottom: 0;
  width: 80px;
  display: flex;
  justify-content: space-around;
  height: 100%;
}

.barra {
  width: 30px;
  transition: height 0.8s ease;
  border-radius: 3px 3px 0 0;
  position: absolute;
  bottom: 0;
}

.barra-verde {
  background-color: var(--verde);
}

.barra-laranja {
  background-color: var(--laranja);
}

.barra-valor {
  position: absolute;
  width: 100%;
  text-align: center;
  top: -18px;
  font-size: 11px;
  font-weight: bold;
}

.barra-label {
  position: absolute;
  width: 100%;
  text-align: center;
  bottom: -30px;
  font-size: 11px;
  color: var(--cinza);
}

.linha-diferenca {
  position: absolute;
  width: 60px;
  height: 1px;
  background-color: var(--branco);
  z-index: 5;
}

.linha-diferenca::before, .linha-diferenca::after {
  content: '';
  position: absolute;
  width: 6px;
  height: 1px;
  background-color: var(--branco);
}

.linha-diferenca::before {
  left: 0;
  transform: rotate(45deg);
  transform-origin: left;
}

.linha-diferenca::after {
  right: 0;
  transform: rotate(-45deg);
  transform-origin: right;
}

.diferenca-valor {
  position: absolute;
  background-color: rgba(0, 0, 0, 0.7);
  color: var(--branco);
  font-size: 10px;
  padding: 2px 5px;
  border-radius: 3px;
  white-space: nowrap;
  z-index: 10;
}

.linha-grade {
  position: absolute;
  left: 0;
  width: 100%;
  height: 1px;
  background: rgba(255, 255, 255, 0.1);
}

.marcador-y {
  position: absolute;
  left: -60px;
  transform: translateY(50%);
  color: var(--cinza);
  font-size: 11px;
  text-align: right;
  width: 50px;
}

.legenda {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: 10px;
}

.legenda-item {
  display: flex;
  align-items: center;
  gap: 5px;
  font-size: 12px;
}

.legenda-cor {
  width: 12px;
  height: 12px;
  border-radius: 2px;
}

.legenda-verde {
  background-color: var(--verde);
}

.legenda-laranja {
  background-color: var(--laranja);
}

.legenda-diferenca {
  position: relative;
  width: 20px;
  height: 12px;
}

.legenda-diferenca::before {
  content: '';
  position: absolute;
  top: 5px;
  left: 0;
  width: 20px;
  height: 1px;
  background-color: var(--branco);
}

.legenda-diferenca::after {
  content: '';
  position: absolute;
  top: 5px;
  right: 0;
  width: 6px;
  height: 1px;
  background-color: var(--branco);
  transform: rotate(-45deg);
  transform-origin: right;
}

.nota {
  margin-top: 20px;
  padding: 15px;
  background: rgba(236, 112, 0, 0.1);
  border-left: 3px solid var(--laranja);
  border-radius: 0 5px 5px 0;
  font-size: 14px;
}

@media (max-width: 768px) {
  .painel {
    grid-template-columns: 1fr;
  }
  
  .resultados {
    grid-template-columns: 1fr;
  }
}
</style>
</head>
<body>



<!-- Assinatura com efeito de marca d'água no canto superior DIREITO-->
<div class="watermark">
    <p><strong>Autor:</strong> Igor Stramandinoli Moita Pontes</p>
    <p><strong>E-mail:</strong> igor.pontes@itau-unibanco.com.br</p>
</div>

<style>
.watermark {
    position: fixed;
    top: 20px; /* trocado de bottom para top */
    right: 20px; /* trocado de right para left */
    background-color: rgba(19, 49, 52, 0.3); /* fundo com transparência */
    border: 1px solid rgba(166, 207, 46, 0.4); /* borda verde translúcida */
    border-radius: 10px;
    padding: 14px 18px;
    color: rgba(255, 255, 255, 0.6); /* texto branco translúcido */
    font-family: 'Segoe UI', sans-serif;
    font-size: 13px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    z-index: 9999;
    pointer-events: none;
    user-select: none;
    max-width: 300px;
    opacity: 0.7; /* transparência geral do bloco */
}

.watermark p {
    margin: 4px 0;
}

.watermark strong {
    color: rgba(166, 207, 46, 0.7); /* destaque verde translúcido */
}
</style>



  <div class="container">
    <header>
      <h1>Simulador PU Curva vs PU Indicativo</h1>
      <p>Visualize o impacto da marcação a mercado em D+1 para ativos de crédito privado</p>
    </header>
    
    <div class="painel">
      <div class="card">
        <h2>Parâmetros</h2>
        
        <div class="slider-grupo">
          <label for="valorInvestido">Valor Investido (R$)</label>
          <div class="slider-info">
            <span>10.000</span>
            <span class="slider-valor" id="valorInvestidoDisplay">R$ 100.000,00</span>
            <span>1.000.000</span>
          </div>
          <input type="range" id="valorInvestido" min="10000" max="1000000" step="10000" value="100000">
        </div>
        
        <div class="slider-grupo">
          <label for="prazoTitulo">Prazo do Título (anos)</label>
          <div class="slider-info">
            <span>1</span>
            <span class="slider-valor" id="prazoTituloDisplay">5 anos</span>
            <span>20</span>
          </div>
          <input type="range" id="prazoTitulo" min="1" max="20" step="1" value="5">
        </div>
        
        <div class="slider-grupo">
          <label for="taxaContratacao">Taxa de Contratação (% a.a.)</label>
          <div class="slider-info">
            <span>5%</span>
            <span class="slider-valor" id="taxaContratacaoDisplay">10.5%</span>
            <span>20%</span>
          </div>
          <input type="range" id="taxaContratacao" min="5" max="20" step="0.1" value="10.5">
        </div>
        
        <div class="slider-grupo">
          <label for="spreadCredito">Spread de Crédito (% a.a.)</label>
          <div class="slider-info">
            <span>-5%</span>
            <span class="slider-valor" id="spreadCreditoDisplay">2.00%</span>
            <span>5%</span>
          </div>
          <input type="range" id="spreadCredito" min="-5" max="5" step="0.05" value="2">
        </div>
        
        <div class="slider-grupo">
          <label for="variacaoMercado">Variação de Mercado (% a.a.)</label>
          <div class="slider-info">
            <span>-5%</span>
            <span class="slider-valor" id="variacaoMercadoDisplay">-0.50%</span>
            <span>5%</span>
          </div>
          <input type="range" id="variacaoMercado" min="-5" max="5" step="0.05" value="-0.5">
        </div>
        
        <button id="calcularBtn">Simular Marcação em D+1</button>
      </div>
      
      <div class="card">
        <h2>Resultados</h2>
        
        <div class="resultados">
          <div class="resultado-item">
            <div class="resultado-label">PU Contratação (D+0)</div>
            <div class="resultado-valor" id="puContratacao">R$ 100.000,00</div>
          </div>
          
          <div class="resultado-item">
            <div class="resultado-label">PU Curva (D+1)</div>
            <div class="resultado-valor" id="puCurvaD1">-</div>
          </div>
          
          <div class="resultado-item">
            <div class="resultado-label">PU Indicativo (D+1)</div>
            <div class="resultado-valor" id="puIndicativoD1">-</div>
          </div>
          
          <div class="resultado-item">
            <div class="resultado-label">Diferença PU Curva vs Indicativo</div>
            <div class="resultado-valor" id="diferencaPUs">-</div>
          </div>
        </div>
        
        <div class="grafico-container">
          <div class="grafico" id="grafico">
            <div class="eixo-x"></div>
            <div class="eixo-y"></div>
            <!-- Barras, linhas de grid e marcadores serão adicionados via JavaScript -->
          </div>
        </div>
        
        <div class="legenda">
          <div class="legenda-item">
            <div class="legenda-cor legenda-verde"></div>
            <span>PU na Curva</span>
          </div>
          <div class="legenda-item">
            <div class="legenda-cor legenda-laranja"></div>
            <span>PU Indicativo</span>
          </div>
          <div class="legenda-item">
            <div class="legenda-diferenca"></div>
            <span>Diferença</span>
          </div>
        </div>
        
        <div class="nota">
          <strong>Explicação:</strong> A marcação a mercado em D+1 reflete o impacto do spread de crédito e da variação de mercado no valor do título. É normal observar uma marcação negativa em títulos de crédito privado logo após a aquisição no mercado secundário.
        </div>
      </div>
    </div>
  </div>

<script>
// Formatação de valores monetários
function formatMoney(value) {
  return 'R$ ' + value.toFixed(2).replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, ".");
}

// Formatação compacta para valores do gráfico
function formatCompact(value) {
  if (Math.abs(value) >= 1000000) {
    return (value / 1000000).toFixed(2).replace('.', ',') + ' M';
  } else if (Math.abs(value) >= 1000) {
    return (value / 1000).toFixed(1).replace('.', ',') + ' K';
  } else {
    return value.toFixed(2).replace('.', ',');
  }
}

// Atualizar os valores exibidos dos sliders
function updateSliderDisplays() {
  // Valor Investido
  const valorInvestido = parseFloat(document.getElementById('valorInvestido').value);
  document.getElementById('valorInvestidoDisplay').textContent = formatMoney(valorInvestido);
  
  // Prazo do Título
  const prazoTitulo = parseInt(document.getElementById('prazoTitulo').value);
  document.getElementById('prazoTituloDisplay').textContent = prazoTitulo + (prazoTitulo === 1 ? ' ano' : ' anos');
  
  // Taxa de Contratação
  const taxaContratacao = document.getElementById('taxaContratacao').value;
  document.getElementById('taxaContratacaoDisplay').textContent = taxaContratacao + '%';
  
  // Spread de Crédito
  const spreadCredito = parseFloat(document.getElementById('spreadCredito').value).toFixed(2);
  document.getElementById('spreadCreditoDisplay').textContent = spreadCredito + '%';
  
  // Variação de Mercado
  const variacaoMercado = parseFloat(document.getElementById('variacaoMercado').value).toFixed(2);
  document.getElementById('variacaoMercadoDisplay').textContent = variacaoMercado + '%';
}

// Cálculo da marcação a mercado
function calcularMarcacao() {
  // Obter valores dos sliders
  const valorInvestido = parseFloat(document.getElementById('valorInvestido').value);
  const prazoTitulo = parseInt(document.getElementById('prazoTitulo').value);
  const taxaContratacao = parseFloat(document.getElementById('taxaContratacao').value) / 100;
  const spreadCredito = parseFloat(document.getElementById('spreadCredito').value) / 100;
  const variacaoMercado = parseFloat(document.getElementById('variacaoMercado').value) / 100;
  
  // Dias úteis
  const diasUteis = prazoTitulo * 252;
  
  // Valor futuro (valor de face no vencimento)
  const valorFuturo = valorInvestido * Math.pow(1 + taxaContratacao, diasUteis / 252);
  
  // Taxa base (descontando o spread)
  const taxaBase = taxaContratacao - spreadCredito;
  
  // Taxa indicativa (taxa base + spread + variação)
  const taxaIndicativa = taxaBase + spreadCredito + variacaoMercado;
  
  // PU Curva em D+1
  const puCurvaD1 = valorFuturo / Math.pow(1 + taxaContratacao, (diasUteis - 1) / 252);
  
  // PU Indicativo em D+1
  const puIndicativoD1 = valorFuturo / Math.pow(1 + taxaIndicativa, (diasUteis - 1) / 252);
  
  // Diferença entre PU Curva e PU Indicativo
  const diferencaPUs = puIndicativoD1 - puCurvaD1;
  const diferencaPercentual = (diferencaPUs / puCurvaD1) * 100;
  
  // Atualizar elementos na interface
  document.getElementById('puContratacao').textContent = formatMoney(valorInvestido);
  document.getElementById('puCurvaD1').textContent = formatMoney(puCurvaD1);
  
  const elementoPuIndicativo = document.getElementById('puIndicativoD1');
  elementoPuIndicativo.textContent = formatMoney(puIndicativoD1);
  elementoPuIndicativo.className = puIndicativoD1 < valorInvestido ? 'resultado-valor valor-negativo' : 'resultado-valor';
  
  const elementoDiferenca = document.getElementById('diferencaPUs');
  elementoDiferenca.textContent = formatMoney(diferencaPUs) + ` (${diferencaPercentual.toFixed(2)}%)`;
  elementoDiferenca.className = diferencaPUs < 0 ? 'resultado-valor valor-negativo' : 'resultado-valor';
  
  // Desenhar o gráfico
  desenharGrafico(valorInvestido, puCurvaD1, puIndicativoD1);
}

// Desenhar gráfico de barras com escala crescente correta
function desenharGrafico(valorD0, valorCurvaD1, valorIndicativoD1) {
  const grafico = document.getElementById('grafico');
  
  // Limpar elementos existentes
  grafico.innerHTML = '<div class="eixo-x"></div><div class="eixo-y"></div>';
  
  // Encontrar valores para escala
  const valores = [valorD0, valorCurvaD1, valorIndicativoD1];
  
  // Escala começa em 0 e vai até o valor máximo com 10% de margem
  const valorMinimo = 0;
  const valorMaximo = Math.max(...valores) * 1.1;
  
  const altura = grafico.clientHeight;
  const largura = grafico.clientWidth;
  
  // Adicionar linhas de grade e marcadores do eixo Y
  const numLinhas = 5;
  const incremento = valorMaximo / (numLinhas - 1);
  
  for (let i = 0; i < numLinhas; i++) {
    const valor = i * incremento;
    // Calculando a posição Y a partir da base (bottom: 0)
    const posY = (valor / valorMaximo) * altura;
    
    // Linha de grade - ajuste de posição para crescer de baixo para cima
    const linha = document.createElement('div');
    linha.className = 'linha-grade';
    linha.style.bottom = posY + 'px';
    grafico.appendChild(linha);
    
    // Marcador no eixo Y
    const marcador = document.createElement('div');
    marcador.className = 'marcador-y';
    marcador.style.bottom = posY + 'px';
    marcador.textContent = formatCompact(valor);
    grafico.appendChild(marcador);
  }
  
  // Criar grupo de barras para D+0
  const grupoD0 = document.createElement('div');
  grupoD0.className = 'barra-grupo';
  grupoD0.style.left = (largura * 0.25) - 40 + 'px';
  
  // Criar barras D+0
  const barraD0Curva = document.createElement('div');
  barraD0Curva.className = 'barra barra-verde';
  barraD0Curva.style.height = '0'; // Começa com altura zero para animação
  barraD0Curva.style.left = '10px';
  
  const valorD0CurvaEl = document.createElement('div');
  valorD0CurvaEl.className = 'barra-valor';
  valorD0CurvaEl.textContent = formatCompact(valorD0);
  barraD0Curva.appendChild(valorD0CurvaEl);
  
  const labelD0Curva = document.createElement('div');
  labelD0Curva.className = 'barra-label';
  labelD0Curva.textContent = 'Curva D+0';
  barraD0Curva.appendChild(labelD0Curva);
  
  const barraD0Indicativo = document.createElement('div');
  barraD0Indicativo.className = 'barra barra-laranja';
  barraD0Indicativo.style.height = '0';
  barraD0Indicativo.style.left = '40px';
  
  const valorD0IndicativoEl = document.createElement('div');
  valorD0IndicativoEl.className = 'barra-valor';
  valorD0IndicativoEl.textContent = formatCompact(valorD0);
  barraD0Indicativo.appendChild(valorD0IndicativoEl);
  
  const labelD0Indicativo = document.createElement('div');
  labelD0Indicativo.className = 'barra-label';
  labelD0Indicativo.textContent = 'Mercado D+0';
  barraD0Indicativo.appendChild(labelD0Indicativo);
  
  grupoD0.appendChild(barraD0Curva);
  grupoD0.appendChild(barraD0Indicativo);
  grafico.appendChild(grupoD0);
  
  // Criar grupo de barras para D+1
  const grupoD1 = document.createElement('div');
  grupoD1.className = 'barra-grupo';
  grupoD1.style.left = (largura * 0.75) - 40 + 'px';
  
  // Criar barras D+1
  const barraD1Curva = document.createElement('div');
  barraD1Curva.className = 'barra barra-verde';
  barraD1Curva.style.height = '0';
  barraD1Curva.style.left = '10px';
  barraD1Curva.id = 'barraD1Curva';
  
  const valorD1CurvaEl = document.createElement('div');
  valorD1CurvaEl.className = 'barra-valor';
  valorD1CurvaEl.textContent = formatCompact(valorCurvaD1);
  barraD1Curva.appendChild(valorD1CurvaEl);
  
  const labelD1Curva = document.createElement('div');
  labelD1Curva.className = 'barra-label';
  labelD1Curva.textContent = 'Curva D+1';
  barraD1Curva.appendChild(labelD1Curva);
  
  const barraD1Indicativo = document.createElement('div');
  barraD1Indicativo.className = 'barra barra-laranja';
  barraD1Indicativo.style.height = '0';
  barraD1Indicativo.style.left = '40px';
  barraD1Indicativo.id = 'barraD1Indicativo';
  
  const valorD1IndicativoEl = document.createElement('div');
  valorD1IndicativoEl.className = 'barra-valor';
  valorD1IndicativoEl.textContent = formatCompact(valorIndicativoD1);
  barraD1Indicativo.appendChild(valorD1IndicativoEl);
  
  const labelD1Indicativo = document.createElement('div');
  labelD1Indicativo.className = 'barra-label';
  labelD1Indicativo.textContent = 'Mercado D+1';
  barraD1Indicativo.appendChild(labelD1Indicativo);
  
  grupoD1.appendChild(barraD1Curva);
  grupoD1.appendChild(barraD1Indicativo);
  grafico.appendChild(grupoD1);
  
  // Animar as barras sequencialmente com altura correta
  setTimeout(() => {
    // Altura proporcional ao valor
    const alturaD0 = (valorD0 / valorMaximo) * altura;
    barraD0Curva.style.height = alturaD0 + 'px';
    barraD0Indicativo.style.height = alturaD0 + 'px';
    
    setTimeout(() => {
      const alturaD1Curva = (valorCurvaD1 / valorMaximo) * altura;
      const alturaD1Indicativo = (valorIndicativoD1 / valorMaximo) * altura;
      
      barraD1Curva.style.height = alturaD1Curva + 'px';
      barraD1Indicativo.style.height = alturaD1Indicativo + 'px';
      
      // Adicionar comparação visual após as barras serem animadas
      setTimeout(() => {
        // Apenas adicionar a comparação se os valores forem diferentes
        if (valorCurvaD1 !== valorIndicativoD1) {
          const diferenca = Math.abs(valorCurvaD1 - valorIndicativoD1);
          const percentualDiferenca = (diferenca / valorCurvaD1) * 100;
          const isPositiva = valorIndicativoD1 > valorCurvaD1;
          
          // Determinar qual barra é maior e qual é menor
          const barraMaior = isPositiva ? barraD1Indicativo : barraD1Curva;
          const barraMenor = isPositiva ? barraD1Curva : barraD1Indicativo;
          const alturaMaior = isPositiva ? alturaD1Indicativo : alturaD1Curva;
          const alturaMenor = isPositiva ? alturaD1Curva : alturaD1Indicativo;
          
          // Posição Y para a linha de diferença
          const posY = alturaMenor;
          
          // Criar linha de diferença
          const linhaDiferenca = document.createElement('div');
          linhaDiferenca.className = 'linha-diferenca';
          linhaDiferenca.style.bottom = posY + 'px';
          linhaDiferenca.style.left = barraMenor.offsetLeft + 'px';
          
          // Criar o elemento com o valor da diferença
          const diferencaValor = document.createElement('div');
          diferencaValor.className = 'diferenca-valor';
          diferencaValor.textContent = formatCompact(diferenca) + ' (' + percentualDiferenca.toFixed(2) + '%)';
          diferencaValor.style.bottom = (posY + 10) + 'px';
          diferencaValor.style.left = (barraMenor.offsetLeft + 30) + 'px';
          
          // Adicionar elementos ao grupo
          grupoD1.appendChild(linhaDiferenca);
          grupoD1.appendChild(diferencaValor);
        }
      }, 800);
    }, 800);
  }, 300);
}

// Inicializar
document.addEventListener('DOMContentLoaded', function() {
  // Atualizar displays iniciais
  updateSliderDisplays();
  
  // Adicionar event listeners para os sliders
  document.querySelectorAll('input[type="range"]').forEach(slider => {
    slider.addEventListener('input', updateSliderDisplays);
  });
  
  // Adicionar event listener para o botão de calcular
  document.getElementById('calcularBtn').addEventListener('click', calcularMarcacao);
  
  // Calcular inicialmente
  calcularMarcacao();
});
</script>
</body>
</html>